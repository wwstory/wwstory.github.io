I"-¿<h1 id="ç®€ä»‹">ç®€ä»‹</h1>

<p>æˆ‘ä»¬ä¹¦å†™çš„ç¨‹åºä¸­ï¼Œå„ä¸ªç±»ä¹‹é—´æœ‰ä¾èµ–çš„ï¼Œéœ€è¦æ‰‹åŠ¨å®ä¾‹åŒ–ä¾èµ–ç±»å†èµ‹ç»™å®ƒã€‚æ—¢ç„¶æˆ‘ä»¬éƒ½é€šè¿‡IoCå®¹å™¨è‡ªåŠ¨ç®¡ç†Beanäº†ï¼Œæ¯æ¬¡ä½¿ç”¨éƒ½éœ€è¦è‡ªå·±ç®¡ç†è¿™æ ·çš„ä¾èµ–å…³ç³»è¿‡äºç¹çã€‚</p>

<p>äºæ˜¯å°±æœ‰äº†é€šè¿‡é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œä½¿å…¶è‡ªåŠ¨æ³¨å…¥ä¾èµ–çš„beanã€‚</p>

<p>springæä¾›3ç§è£…é…çš„æ–¹å¼ï¼š<code class="highlighter-rouge">xmlè£…é…</code>ï¼Œ<code class="highlighter-rouge">javaè£…é…</code>ï¼Œ<code class="highlighter-rouge">è‡ªåŠ¨è£…é…</code>ã€‚</p>

<blockquote>
  <p>ç›¸æ¯”äº<code class="highlighter-rouge">xmlè£…é…</code>ï¼Œæ¨èçš„æ˜¯ä½¿ç”¨<code class="highlighter-rouge">javaè£…é…</code>ã€‚</p>
</blockquote>

<p>é€šå¸¸ä½¿ç”¨<code class="highlighter-rouge">è‡ªåŠ¨è£…é…</code>ï¼Œå‡å°‘é…ç½®æ–‡ä»¶ã€‚</p>

<h1 id="è‡ªåŠ¨è£…é…">è‡ªåŠ¨è£…é…</h1>

<p>springä»2ä¸ªè§’åº¦å®ç°è‡ªåŠ¨è£…é…ï¼š</p>
<ul>
  <li><code class="highlighter-rouge">ç»„ä»¶æ‰«æ</code>ï¼šspringä¼šè‡ªåŠ¨å‘ç°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€åˆ›å»ºçš„beanã€‚</li>
  <li><code class="highlighter-rouge">è‡ªåŠ¨è£…é…</code>ï¼šspringè‡ªåŠ¨å°†æ»¡è¶³çš„beanè£…é…ã€‚</li>
</ul>

<h2 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
â”œâ”€â”€ build.gradle
â””â”€â”€ src/
    â”œâ”€â”€ main/
    â”‚Â Â  â”œâ”€â”€ java/
    â”‚Â Â  â”‚Â Â  â””â”€â”€ com/
    â”‚Â Â  â”‚Â Â      â””â”€â”€ yww/
    â”‚Â Â  â”‚Â Â          â”œâ”€â”€ Main.java
    â”‚Â Â  â”‚Â Â          â”œâ”€â”€ Message.java
    â”‚Â Â  â”‚Â Â          â”œâ”€â”€ ReaderConfig.java
    â”‚Â Â  â”‚Â Â          â””â”€â”€ Reader.java
    â”‚Â Â  â””â”€â”€ resources/
    â”‚Â Â      â””â”€â”€ beans.xml
    â””â”€â”€ test/
        â”œâ”€â”€ java/
        â”‚Â Â  â””â”€â”€ com/
        â”‚Â Â      â””â”€â”€ yww/
        â”‚Â Â          â””â”€â”€ MainTest.java
        â””â”€â”€ resources/
</code></pre></div></div>

<h2 id="ä»£ç ">ä»£ç </h2>

<p><code class="highlighter-rouge">build.gradle</code>é¡¹ç›®æ„å»ºé…ç½®ã€‚</p>

<blockquote>
  <p>æ³¨é‡Šçš„éƒ¨åˆ†æ˜¯ä½¿ç”¨æ’ä»¶å¹¶ç›´æ¥<code class="highlighter-rouge">gradle run</code>å‘½ä»¤è¿è¡Œé¡¹ç›®ã€‚<code class="highlighter-rouge">jar{}</code>éƒ¨åˆ†çš„é…ç½®ï¼Œå¯ä»¥æ‰“åŒ…æˆä¸€ä¸ªç”¨<code class="highlighter-rouge">java</code>å‘½ä»¤è¿è¡Œçš„<code class="highlighter-rouge">jar</code>åŒ…ã€‚ï¼ˆæ³¨æ„éœ€è¦æŒ‡å®šå¥½ä¸»ç±»çš„å…¨åï¼‰</p>
</blockquote>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plugins</span> <span class="o">{</span>
    <span class="n">id</span> <span class="s1">'java'</span>
    <span class="c1">// id 'application'</span>
<span class="o">}</span>

<span class="c1">// mainClassName = 'com.yww.Main'</span>
<span class="n">group</span> <span class="s1">'com.yww'</span>
<span class="n">version</span> <span class="s1">'1.0-SNAPSHOT'</span>

<span class="n">sourceCompatibility</span> <span class="o">=</span> <span class="mf">1.8</span>

<span class="k">repositories</span> <span class="o">{</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
<span class="o">}</span>

<span class="n">ext</span><span class="o">{</span>
    <span class="n">springVersion</span> <span class="o">=</span> <span class="s1">'5.2.0.RELEASE'</span>
<span class="o">}</span>

<span class="k">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="s2">"org.springframework:spring-core:$springVersion"</span>
    <span class="n">compile</span> <span class="s2">"org.springframework:spring-context:$springVersion"</span>
    <span class="n">compile</span> <span class="s2">"org.springframework:spring-beans:$springVersion"</span>
    <span class="n">compile</span> <span class="s2">"org.springframework:spring-expression:$springVersion"</span>
    <span class="n">compile</span> <span class="s2">"org.springframework:spring-aop:$springVersion"</span>
    <span class="n">compile</span> <span class="s2">"org.springframework:spring-aspects:$springVersion"</span>

    <span class="n">testCompile</span> <span class="s2">"junit:junit:4.12"</span>
    <span class="n">testCompile</span> <span class="s2">"org.springframework:spring-test:$springVersion"</span>
<span class="o">}</span>

<span class="n">jar</span> <span class="o">{</span>
    <span class="n">from</span> <span class="o">{</span>
        <span class="n">configurations</span><span class="o">.</span><span class="na">runtime</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span><span class="n">zipTree</span><span class="o">(</span><span class="n">it</span><span class="o">)}</span>
    <span class="o">}</span>
    <span class="n">manifest</span> <span class="o">{</span>
        <span class="n">attributes</span> <span class="s1">'Main-Class'</span><span class="o">:</span> <span class="s1">'com.yww.Main'</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">Message.java</code>é€šè¿‡ä½¿ç”¨<code class="highlighter-rouge">@Component</code>æ³¨è§£ï¼Œåœ¨ç»„ä»¶æ‰«ææ—¶ï¼Œæ³¨å†Œbeanã€‚</p>

<blockquote>
  <p><code class="highlighter-rouge">@Value</code>æ³¨è§£ç®€å•ç›´æ¥èµ‹å€¼ã€‚ä¸åŒäºxmlé…ç½®æ–‡ä»¶é…ç½®beanè¿™ä¹ˆç¹çã€‚</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Message</span> <span class="o">{</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"---hello world---"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">msg</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getMsg</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMsg</span><span class="o">(</span><span class="nc">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="s">"this mssage is : "</span> <span class="o">+</span> <span class="n">msg</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p><code class="highlighter-rouge">Reader.java</code>ä¾èµ–äº<code class="highlighter-rouge">Message.java</code>ï¼Œä½¿ç”¨<code class="highlighter-rouge">@Autowired</code>æ³¨å…¥<code class="highlighter-rouge">Message</code>è¿™ä¸ªbeanåˆ°<code class="highlighter-rouge">Reader</code>ä¸­ã€‚</p>

<blockquote>
  <p>æ­¤å¤„å¯ä»¥å°†<code class="highlighter-rouge">@Autowired</code>å†™åœ¨æˆå‘˜å˜é‡ä¸Šï¼Œä¹Ÿå¯å†™åœ¨æ„é€ å‡½æ•°ä¸Šï¼ŒäºŒè€…é€‰å…¶ä¸€çš†å¯ã€‚ï¼ˆæ„é€ å‡½æ•°è‡ªåŠ¨è¿çº¿å¯ä»¥åšä¸€äº›å…¶å®ƒæ“ä½œè€Œå·²ï¼‰</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reader</span> <span class="o">{</span>
<span class="c1">//    @Autowired</span>
    <span class="kd">private</span> <span class="nc">Message</span> <span class="n">msg</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">Reader</span><span class="o">(</span><span class="nc">Message</span> <span class="n">msg</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">getMsg</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p><code class="highlighter-rouge">ReaderConfig.java</code>é…ç½®æ–‡ä»¶ï¼Œä¸»è¦æ—¶ç”¨äºåœ¨è·å–åº”ç”¨ä¸Šä¸‹æ–‡æ—¶ï¼Œè®¾ç½®æ­¤ç±»å¯ä»¥å®Œæˆå¼€å¯å…¶ä¸­çš„é…ç½®ã€‚å…¶ç±»åä»»æ„ã€‚è¿™é‡Œä¸»è¦æ˜¯å¼€å¯ç»„ä»¶æ‰«æï¼Œå°†é»˜è®¤åŒåŒ…åä¸‹å¸¦æœ‰<code class="highlighter-rouge">@Component</code>ç­‰æ³¨è§£çš„ç±»æ³¨å†Œä¸ºbeanã€‚</p>

<blockquote>
  <p>ä¹ æƒ¯ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­¤å¤„åšä¸€äº›é…ç½®å·¥ä½œï¼Œæ¯”å¦‚è®¾ç½®åˆå§‹å€¼ï¼Œæˆ–è€…å¦‚ä½•è£…é…ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œåˆå§‹å€¼åœ¨å‰é¢å·²ä½¿ç”¨<code class="highlighter-rouge">@Value</code>è®¾ç½®ã€‚</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReaderConfig</span> <span class="o">{</span>

    <span class="c1">// å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®åˆå§‹å€¼</span>
    <span class="c1">// ä¸ºäº†æ–¹ä¾¿ç›´æ¥ï¼Œå°±åœ¨Messageçš„æˆå‘˜ä¸Šä½¿ç”¨@Valueè®¾ç½®äº†å€¼ã€‚</span>
<span class="c1">//    @Bean</span>
<span class="c1">//    public Message message(){</span>
<span class="c1">//        Message message = new Message();</span>
<span class="c1">//        message.setMsg("---hi---");</span>
<span class="c1">//        return message;</span>
<span class="c1">//    }</span>
<span class="o">}</span>

</code></pre></div></div>

<p><code class="highlighter-rouge">Main.java</code>ä¸»å‡½æ•°ï¼Œç”¨äºå¯åŠ¨åº”ç”¨ã€‚è¿™é‡Œå±•ç¤ºå¦‚ä½•è·å–åˆ°æœ‰ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”æŒ‰ç…§è‡ªåŠ¨è£…é…å¥½çš„beanã€‚</p>

<blockquote>
  <p>ä¸åŒäºwebåº”ç”¨ï¼Œappéœ€è¦æœ‰ä¸ªä¸»å‡½æ•°å¯åŠ¨åº”ç”¨ï¼Œå¸¸è§„çš„webåº”ç”¨ä¼šæ‰“åŒ…æˆwaræ”¾å…¥tomcatåŠ è½½ï¼Œä¸è¿‡<code class="highlighter-rouge">spring boot</code>çš„webåº”ç”¨ä¹Ÿå¯ä»¥æœ‰ä¸ªä¸»å‡½æ•°å¯åŠ¨webåº”ç”¨ã€‚</p>
</blockquote>

<blockquote>
  <p>ä»£ç é‡Œæ³¨é‡Šçš„éƒ¨åˆ†ï¼Œæ˜¯ä½¿ç”¨<code class="highlighter-rouge">xmlé…ç½®</code>ï¼Œæ¼”ç¤ºå¦‚ä½•è·å–beanã€‚</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ClassPathXmlApplicationContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="c1">// xmlé…ç½®(beans.xml)</span>
<span class="c1">//        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");</span>
<span class="c1">//        Message msg = (Message) context.getBean("msg1");</span>
<span class="c1">//        System.out.println(msg.getMsg());</span>

        <span class="c1">// javaé…ç½®(ReaderConfig.java) + è·å–ç»„ä»¶æ‰«æåˆ°çš„bean</span>
        <span class="c1">// æµ‹è¯•æ–‡ä»¶AppTest.javaä¸­ï¼Œå¯ä»¥é€šè¿‡æ³¨è§£@ContextConfigurationåŠ è½½é…ç½®æ–‡ä»¶ä¸Šä¸‹æ–‡ï¼Œæ–¹ä¾¿ä½¿ç”¨@Autowiredæ³¨è§£è·å–Beanã€‚</span>
        <span class="nc">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">com</span><span class="o">.</span><span class="na">yww</span><span class="o">.</span><span class="na">ReaderConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">Reader</span> <span class="n">reader</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Reader</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">Reader</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">reader</span><span class="o">.</span><span class="na">print</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>æœ€åå‰©ä¸‹æµ‹è¯•æ–‡ä»¶<code class="highlighter-rouge">MainTest.java</code>ï¼Œè¿™é‡Œä¸å¤šè¿‡é—®ï¼Œåªæ˜¯å¯ä»¥ä½¿ç”¨<code class="highlighter-rouge">@ContextConfiguration</code>æ³¨è§£è·å–ä¸Šä¸‹æ–‡çš„beanï¼Œåœ¨ä½¿ç”¨<code class="highlighter-rouge">@Autowired</code>è‡ªåŠ¨æ³¨å…¥beanï¼Œæ–¹ä¾¿äº†æµ‹è¯•ã€‚</p>

<h2 id="è¿è¡Œ">è¿è¡Œ</h2>

<blockquote>
  <p>å› ä¸ºä¸ºäº†ç®€å•ï¼Œé¡¹ç›®æ˜¯éwebé¡¹ç›®ï¼Œå¾ˆå°‘æœ‰å¸–å­è®²è§£å¯¹æ­¤çš„æ‰“åŒ…å’Œè¿è¡Œã€‚ï¼ˆwebé¡¹ç›®å°±å¾ˆå®¹æ˜“é€šè¿‡æ·»åŠ <code class="highlighter-rouge">war</code>æ’ä»¶å’Œ<code class="highlighter-rouge">gradle build</code>æ‰“åŒ…ï¼‰</p>
</blockquote>

<p>è¿è¡Œçš„æ–¹æ³•å°è¯•å‡ºäº†å‡ ç§ï¼š</p>

<ul>
  <li>
    <p>æ–¹æ³•1ï¼šä½¿ç”¨ideaç›´æ¥è¿è¡Œ<code class="highlighter-rouge">main</code>ç±»å³å¯ï¼Œä¹Ÿå¯è¿è¡Œæµ‹è¯•ç±»<code class="highlighter-rouge">MainTest.java</code>ã€‚</p>
  </li>
  <li>
    <p>æ–¹æ³•2ï¼šä½¿ç”¨gradleï¼Œéœ€è¦åœ¨<code class="highlighter-rouge">build.gradle</code>æ–‡ä»¶ä¸­ï¼Œæ·»åŠ æ’ä»¶<code class="highlighter-rouge">application</code>ï¼Œå¹¶è®¾ç½®å¥½ä¸»å‡½æ•°çš„åç§°<code class="highlighter-rouge">mainClassName</code>ã€‚æœ€ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼ˆ<code class="highlighter-rouge">build.gradle</code>åŒçº§ç›®å½•ï¼‰æ‰§è¡Œå‘½ä»¤ï¼š</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gradle run
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="é—®é¢˜å¤„ç†">é—®é¢˜å¤„ç†</h2>

<blockquote>
  <p>åœ¨<code class="highlighter-rouge">éweb</code>åº”ç”¨ä¸­ï¼Œä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œæ— æ³•é€šè¿‡<code class="highlighter-rouge">@Autowired</code>è·å–åˆ°beanï¼Œè¿™æ˜¯ç”±äºéwebåº”ç”¨æ— æ³•çŸ¥é“beanï¼Œä¹Ÿæ²¡æœ‰æä¾›ç›¸åº”çš„æ³¨è§£å»å¤„ç†ï¼Œåªèƒ½é€šè¿‡<code class="highlighter-rouge">ApplicationContext</code>åº”ç”¨ä¸Šä¸‹æ–‡è·å–beanã€‚è€Œbeanä¹‹é—´æ˜¯å¯ä»¥é€šè¿‡<code class="highlighter-rouge">@Autowired</code>è·å–åˆ°çš„ã€‚</p>
</blockquote>

<h1 id="javaè£…é…">javaè£…é…</h1>

<p>å¾ˆå¤šæ—¶å€™ï¼Œé€šè¿‡ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…å®ç°è‡ªåŠ¨åŒ–é…ç½®éƒ½æ˜¯æ¨èçš„æ–¹å¼ã€‚ä½†å¦‚æœè¦å°†ç¬¬ä¸‰æ–¹åº“è£…é…åˆ°è‡ªå·±çš„åº”ç”¨ä¸­ï¼Œå°±æ— æ³•ä½¿ç”¨<code class="highlighter-rouge">@Component</code>æ³¨è§£å®ç°è‡ªåŠ¨åŒ–è£…é…ã€‚</p>

<p>è¦æƒ³æ˜¾å¼é…ç½®beanï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨<code class="highlighter-rouge">@Bean</code>è·å–ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/main/java/com/yww/ReaderConfig.java</span>
<span class="c1">// ...</span>
<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">Message</span> <span class="nf">message</span><span class="o">(){</span>
    <span class="nc">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Message</span><span class="o">();</span>
    <span class="n">message</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">"---hi---"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">// ...</span>
</code></pre></div></div>

<blockquote>
  <p>ä½¿ç”¨è‡ªåŠ¨è£…é…ï¼Œä¸èƒ½åˆ›å»ºå¤šä¸ªåŒç±»å‹çš„beanã€‚</p>
</blockquote>

<h2 id="beanæ›´å">Beanæ›´å</h2>

<p>é»˜è®¤beançš„IDä¸<code class="highlighter-rouge">@Bean</code>æ³¨è§£çš„æ–¹æ³•åä¸€æ ·çš„ã€‚</p>

<p>å¯æä¾›<code class="highlighter-rouge">name</code>å‚æ•°è®¾ç½®å…¶å®ƒåç§°ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"msgX"</span><span class="o">)</span>
</code></pre></div></div>

<h2 id="ä¸ä½¿ç”¨ç»„ä»¶æ‰«æçš„é…ç½®">ä¸ä½¿ç”¨ç»„ä»¶æ‰«æçš„é…ç½®</h2>

<p>å¦‚æœä¸ä½¿ç”¨ç»„ä»¶æ‰«æï¼Œé‚£ä¹ˆä¸€ä¸ªé…ç½®å¦‚ä½•æ‰¾åˆ°å¦ä¸€ä¸ªé…ç½®ï¼Œæˆ–è€…beanï¼Ÿ</p>

<p>æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code class="highlighter-rouge">@Import</code>å¯¼å…¥é‚£ä¸ªç±»ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Import</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@Import</span><span class="o">({</span><span class="nc">MessageConfig</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReaderConfig</span> <span class="o">{</span>

    <span class="c1">// å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®åˆå§‹å€¼</span>
    <span class="c1">// ä¸ºäº†æ–¹ä¾¿ç›´æ¥ï¼Œå°±åœ¨Messageçš„æˆå‘˜ä¸Šä½¿ç”¨@Valueè®¾ç½®äº†å€¼ã€‚</span>
<span class="c1">//    @Bean</span>
<span class="c1">//    @Bean(name="msgX")</span>
<span class="c1">//    public Message message(){</span>
<span class="c1">//        Message message = new Message();</span>
<span class="c1">//        message.setMsg("---hi---");</span>
<span class="c1">//        return message;</span>
<span class="c1">//    }</span>

    <span class="c1">// è¿™ä¸ªbeanä¼ å…¥çš„åç§°å¯ä»¥ä»»æ„.</span>
    <span class="c1">// ä½†å¦‚æœåœ¨åŒä¸€ä¸ªç±»é‡Œå£°æ˜äº†åç§°ï¼Œåƒä¸Šé¢é‚£æ ·æŒ‡å®šäº†åè¯ï¼Œè¿™é‡Œçš„å‚æ•°åä¹Ÿå¿…é¡»ç›¸åŒã€‚</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Reader</span> <span class="nf">reader</span><span class="o">(</span><span class="nc">Message</span> <span class="n">msg</span><span class="o">){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">getMsg</span><span class="o">());</span>
        <span class="n">msg</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">"---hello---"</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Reader</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>å…¶ä¸­ï¼Œå¯¼å…¥çš„å¦ä¸€ä¸ªbeançš„<code class="highlighter-rouge">javaé…ç½®</code>æ–‡ä»¶å¦‚ä¸‹ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/main/java/com/yww/MessageConfig.java</span>
<span class="kn">package</span> <span class="nn">com.yww</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Message</span> <span class="nf">message</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Message</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="xmlè£…é…">xmlè£…é…</h1>

<ul>
  <li>gradle appçš„<code class="highlighter-rouge">xmlé…ç½®</code>æ”¾åœ¨<code class="highlighter-rouge">src/main/resources/</code>ç›®å½•ä¸‹ã€‚</li>
  <li>webçš„<code class="highlighter-rouge">xmlé…ç½®</code>æ”¾åœ¨<code class="highlighter-rouge">web/WEB-INF/</code>ç›®å½•ä¸‹ï¼Œéœ€è¦åœ¨<code class="highlighter-rouge">web.xml</code>ä¸­é…ç½®<code class="highlighter-rouge">&lt;context-param&gt;</code>ã€‚</li>
</ul>

<p>é…ç½®å½¢å¦‚ä¸‹é¢è¿™ä¸ªã€‚</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>

<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/

    &lt;bean id="</span><span class="err">msg1"</span> <span class="na">class=</span><span class="s">"com.yww.Message"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"msg"</span> <span class="na">value=</span><span class="s">"hello world"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</code></pre></div></div>

<p>å¦‚æœä¸ç»™<code class="highlighter-rouge">id</code>ï¼Œå°†ä¼šé€šè¿‡å…¨é™å®šç±»åæ¥å‘½åï¼Œæ­¤å¤„çš„beanå°†ä¼šè¢«å‘½åä¸º<code class="highlighter-rouge">com.yww.Message#0</code>ï¼Œ<code class="highlighter-rouge">#0</code>æ˜¯è®¡æ•°åŒç±»å‹çš„å…¶å®ƒbeanã€‚</p>

<h2 id="å…¶å®ƒè®¾ç½®">å…¶å®ƒè®¾ç½®</h2>

<p>ç”±äºä¸æ¨èä½¿ç”¨<code class="highlighter-rouge">xmlé…ç½®</code>ï¼Œæ•…åªæ˜¯ç®€å•åœ¨æ­¤è®°ä¸‹æœ‰å“ªäº›é…ç½®ã€‚</p>

<blockquote>
  <p>å¾ˆå¤šé…ç½®æœ‰<code class="highlighter-rouge">c-å‘½åç©ºé—´</code>ï¼Œ<code class="highlighter-rouge">p-å‘½åç©ºé—´</code>å»æ›¿ä»£ç¹æ‚çš„æ ‡ç­¾ã€‚</p>
</blockquote>

<ul>
  <li>æ„é€ å…¶æ³¨å…¥beanå¼•ç”¨ï¼Œæ³¨å…¥å­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œåˆ—è¡¨ç­‰ã€‚ï¼ˆ&lt;constructor-arg&gt;ï¼‰</li>
  <li>ä½¿ç”¨xmlé…ç½®&lt;bean&gt;å¯¼å…¥JavaConfigé…ç½®ã€‚</li>
  <li><code class="highlighter-rouge">&lt;beans&gt;</code>çš„<code class="highlighter-rouge">profile</code>å±æ€§ã€‚</li>
  <li><code class="highlighter-rouge">&lt;jdbc&gt;</code>ï¼Œ<code class="highlighter-rouge">&lt;jee:jndi-lookup&gt;</code>ã€‚</li>
  <li><code class="highlighter-rouge">&lt;beans&gt;</code>åµŒå¥—<code class="highlighter-rouge">&lt;beans&gt;</code>ã€‚</li>
</ul>

<h1 id="é«˜çº§è£…é…">é«˜çº§è£…é…</h1>

<p>æä¾›æ›´å¤šé…ç½®ï¼Œå®ç°æ›´å¤šè£…é…çš„æ§åˆ¶ã€‚</p>

<h2 id="profile">Profile</h2>

<p>é€šå¸¸æˆ‘ä»¬éœ€è¦é…ç½®ä¸åŒçš„ç¯å¢ƒï¼Œå¦‚ï¼šæµ‹è¯•ç¯å¢ƒä½¿ç”¨åµŒå…¥æ•°æ®åº“<code class="highlighter-rouge">h2</code>ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨<code class="highlighter-rouge">jndi</code>è·å–æ•°æ®åº“ç­‰ã€‚</p>

<blockquote>
  <p>ï¼ˆä»spring4å¼€å§‹ï¼‰<code class="highlighter-rouge">@Profile</code>ä¹Ÿæ˜¯åŸºäº<code class="highlighter-rouge">@Conditional</code>å®ç°ã€‚</p>
</blockquote>

<h3 id="è®¾ç½®é…ç½®">è®¾ç½®é…ç½®</h3>

<p>å¯ä»¥ä½¿ç”¨<code class="highlighter-rouge">@Profile</code>æ³¨è§£åœ¨<code class="highlighter-rouge">ç±»</code>æˆ–<code class="highlighter-rouge">æ–¹æ³•</code>ä¸Šï¼Œå»ç”ŸæˆBeanã€‚ï¼ˆæ­¤å¤„ä½¿ç”¨<code class="highlighter-rouge">JavaConfig</code>é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code class="highlighter-rouge">xml</code>é…ç½®ï¼‰</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.*</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"application.properties"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReaderConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="nd">@Profile</span><span class="o">(</span><span class="s">"dev"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Message</span> <span class="nf">message1</span><span class="o">(){</span>
        <span class="nc">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Message</span><span class="o">();</span>
        <span class="n">message</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">"---hi---1"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nd">@Profile</span><span class="o">(</span><span class="s">"prod"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Message</span> <span class="nf">message2</span><span class="o">(){</span>
        <span class="nc">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Message</span><span class="o">();</span>
        <span class="n">message</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">"---hi---2"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<blockquote>
  <p><code class="highlighter-rouge">@PropertySource</code>å¯¼å…¥é…ç½®æ–‡ä»¶ã€‚</p>
</blockquote>

<h3 id="æ¿€æ´»é…ç½®">æ¿€æ´»é…ç½®</h3>

<p>é€šè¿‡ä¸¤ä¸ªå±æ€§ç¡®å®šå“ªä¸ªprofileæ¿€æ´»ï¼Œ<code class="highlighter-rouge">spring.profiles.active</code>å’Œ<code class="highlighter-rouge">spring.profiles.default</code>ã€‚</p>

<p>å¦‚æœè®¾ç½®äº†<code class="highlighter-rouge">active</code>ï¼Œå°±ç”¨æ­¤å€¼ç¡®å®šå“ªä¸ªprofileæ¿€æ´»ã€‚å¦‚æœæ²¡è®¾ç½®<code class="highlighter-rouge">active</code>ï¼Œå°±ç”¨<code class="highlighter-rouge">default</code>ç¡®å®šã€‚å¦‚æœéƒ½æ²¡è®¾ç½®ï¼Œåªä¼šåˆ›å»ºæ²¡æœ‰å®šä¹‰profileçš„beanã€‚</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#src/main/resources/application.properties
</span><span class="py">spring.profiles.default</span><span class="p">=</span><span class="s">dev</span>
<span class="py">spring.profiles.active</span><span class="p">=</span><span class="s">prod</span>
</code></pre></div></div>

<blockquote>
  <p>åœ¨æµ‹è¯•ç±»ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code class="highlighter-rouge">@ActiveProfiles("dev")</code>ä¾¿æ·çš„æ¿€æ´»é…ç½®ã€‚</p>
</blockquote>

<h3 id="å…¶å®ƒæ–¹å¼">å…¶å®ƒæ–¹å¼</h3>

<p>æœ‰å¤šç§æ–¹å¼è®¾ç½®å±æ€§ï¼š</p>
<ul>
  <li>DispatcherServletçš„åˆå§‹åŒ–å‚æ•°ã€‚</li>
  <li>Webåº”ç”¨çš„ä¸Šä¸‹æ–‡å‚æ•°ã€‚</li>
  <li>JNDIæ¡ç›®ã€‚</li>
  <li>ç¯å¢ƒå˜é‡ã€‚</li>
  <li>JVMçš„ç³»ç»Ÿå±æ€§ã€‚</li>
  <li>é›†æˆæµ‹è¯•ç±»ä¸Šï¼Œä½¿ç”¨@ActiveProfilesæ³¨è§£è®¾ç½®ã€‚</li>
</ul>

<p>ä¾‹ï¼Œ<code class="highlighter-rouge">web.xml</code>çš„é…ç½®ã€‚</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;context-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>spring.profiles.default<span class="nt">&lt;/param-name&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>dev<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/context-param&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
</code></pre></div></div>

<h3 id="é™„é…ç½®æ–‡ä»¶æ˜¯å¦‚ä½•å…³è”çš„">é™„ï¼šé…ç½®æ–‡ä»¶æ˜¯å¦‚ä½•å…³è”çš„ï¼Ÿ</h3>

<p>ç¨‹åºå¦‚ä½•æ‰¾åˆ°è¿™ä¸ª<code class="highlighter-rouge">.properties</code>æ–‡ä»¶ï¼Ÿ</p>

<p>åœ¨appé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code class="highlighter-rouge">@PropertySource</code>æ³¨è§£åˆ°JavaConfigç±»ä¸Šï¼Œè®¾ç½®<code class="highlighter-rouge">.properties</code>é…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚</p>

<blockquote>
  <p>åœ¨gradleé¡¹ç›®ä¸­ï¼Œé…ç½®æ–‡ä»¶æ”¾åœ¨<code class="highlighter-rouge">src/main/resources/</code>è·¯å¾„ä¸‹ï¼Œè¿˜å¯ä»¥æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹ã€‚å¦‚ï¼š<code class="highlighter-rouge">src/main/resources/demo/app.properties</code>çš„è®¾ç½®<code class="highlighter-rouge">@PropertySource("demo/app.properties")</code>ã€‚</p>
</blockquote>

<p>åœ¨webé¡¹ç›®ä¸­ï¼Œspring webå·²ç»å°†é…ç½®æ–‡ä»¶è®¾ç½®å¥½äº†ï¼Œä¸éœ€è¦<code class="highlighter-rouge">@PropertySource</code>é…ç½®ã€‚</p>

<h2 id="æ¡ä»¶åŒ–çš„bean">æ¡ä»¶åŒ–çš„Bean</h2>

<p>å¦‚æœå¸Œæœ›å®ç°ä¸€ä¸ªbeanåªæœ‰åœ¨åº”ç”¨çš„ç±»è·¯å¾„ä¸‹åŒ…å«ç‰¹å®šçš„åº“æ—¶æ‰åˆ›å»ºï¼Œæˆ–è€…å¸Œæœ›æŸä¸ªbeanåªæœ‰å½“åœ¨å¦ä¸€ä¸ªç‰¹å®šbeanå£°æ˜ä¹‹åæ‰ä¼šåˆ›å»ºï¼Œæˆ–è€…åœ¨è®¾ç½®äº†ç‰¹å®šçš„ç¯å¢ƒå˜é‡åæ‰ä¼šåˆ›å»ºæŸä¸ªbeanã€‚</p>

<p>é€šè¿‡<code class="highlighter-rouge">@Conditional</code>æ³¨è§£ï¼Œå®ƒå¯ä»¥ç”¨äºå¸¦æœ‰<code class="highlighter-rouge">@Bean</code>æ³¨è§£çš„æ–¹æ³•ä¸Šã€‚å¦‚æœæ¡ä»¶è®¡ç®—ä¸ºtrueå°±ä¼šåˆ›å»ºbeanï¼Œå¦åˆ™è¿™ä¸ªbeanå°±ä¼šè¢«å¿½ç•¥ã€‚</p>

<blockquote>
  <p>æ¡ä»¶åŒ–beanæ˜¯<code class="highlighter-rouge">spring boot</code>è‡ªåŠ¨è£…é…çš„å®ç°åŸç†ã€‚</p>
</blockquote>

<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>

<p>å½“é…ç½®æ–‡ä»¶ä¸­å«æœ‰â€readerâ€å€¼æ—¶ï¼Œåˆ›å»ºbeanã€‚</p>

<p><strong>ç›®å½•ç»“æ„</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
â”œâ”€â”€ build.gradle
â””â”€â”€ src/
    â”œâ”€â”€ main/
    â”‚Â Â  â”œâ”€â”€ java/
    â”‚Â Â  â”‚Â Â  â””â”€â”€ com/
    â”‚Â Â  â”‚Â Â      â””â”€â”€ yww/
    â”‚Â Â  â”‚Â Â          â”œâ”€â”€ Main.java
    â”‚Â Â  â”‚Â Â          â”œâ”€â”€ Message.java
    â”‚Â Â  â”‚Â Â          â”œâ”€â”€ ReaderConfig.java
    â”‚Â Â  â”‚Â Â          â”œâ”€â”€ ReaderExistsCondition.java
    â”‚Â Â  â”‚Â Â          â””â”€â”€ Reader.java
    â”‚Â Â  â””â”€â”€ resources/
    â”‚Â Â      â”œâ”€â”€ application.properties
    â””â”€â”€ test/
        â”œâ”€â”€ java/
        â”‚Â Â  â””â”€â”€ com/
        â”‚Â Â      â””â”€â”€ yww/
        â”‚Â Â          â””â”€â”€ MainTest.java
        â””â”€â”€ resources/
</code></pre></div></div>

<p><strong>å…³é”®ä»£ç </strong></p>

<p>å…ˆå–æ¶ˆäº†<code class="highlighter-rouge">Reader.java</code>ç±»çš„<code class="highlighter-rouge">@Component</code>æ³¨è§£ï¼Œæ–¹ä¾¿æ­¤å¤„ä½¿ç”¨æ¡ä»¶åŒ–æ–¹å¼åˆ›å»ºReaderçš„beanã€‚</p>

<p>è®¾ç½®çš„æ¡ä»¶ä¸º<code class="highlighter-rouge">ReaderExistsCondition.java</code>ï¼Œè¿™ä¸ªç±»ç»§æ‰¿æ¥å£<code class="highlighter-rouge">Condition</code>ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.*</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"application.properties"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReaderConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Message</span> <span class="nf">message1</span><span class="o">(){</span>
        <span class="nc">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Message</span><span class="o">();</span>
        <span class="n">message</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">"---hi---"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nd">@Conditional</span><span class="o">(</span><span class="nc">ReaderExistsCondition</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Reader</span> <span class="nf">reader</span><span class="o">(</span><span class="nc">Message</span> <span class="n">message</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Reader</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>è®¾ç½®çš„æ¡ä»¶ä¸ºï¼Œä»é…ç½®æ–‡ä»¶ä¸­å¯»æ‰¾æ˜¯å¦å­˜åœ¨åä¸º<code class="highlighter-rouge">reader</code>çš„é…ç½®å±æ€§ï¼Œå¦‚æœæ–¹æ³•<code class="highlighter-rouge">matches</code>è¿”å›trueï¼Œå³ä¼šåˆ›å»ºè¢«è®¾ç½®æ¡ä»¶çš„beanã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Condition</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ConditionContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.env.Environment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.type.AnnotatedTypeMetadata</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReaderExistsCondition</span> <span class="kd">implements</span> <span class="nc">Condition</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">matches</span><span class="o">(</span><span class="nc">ConditionContext</span> <span class="n">context</span><span class="o">,</span> <span class="nc">AnnotatedTypeMetadata</span> <span class="n">metadata</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Environment</span> <span class="n">env</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getEnvironment</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="na">containsProperty</span><span class="o">(</span><span class="s">"reader"</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<h3 id="é™„æ¥å£condition">é™„ï¼šæ¥å£Condition</h3>

<p><code class="highlighter-rouge">Condition</code>æ¥å£æºç å¦‚ä¸‹ï¼ŒåªåŒ…å«ä¸€ä¸ª<code class="highlighter-rouge">matches</code>æ–¹æ³•ï¼Œå¦‚æœæ–¹æ³•è¿”å›<code class="highlighter-rouge">true</code>å³ä¼šæ»¡è¶³æ¡ä»¶åˆ›å»ºbeanï¼Œ<code class="highlighter-rouge">false</code>å³ä¸ä¼šåˆ›å»ºã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Condition</span> <span class="o">{</span>

	<span class="kt">boolean</span> <span class="nf">matches</span><span class="o">(</span><span class="nc">ConditionContext</span> <span class="n">context</span><span class="o">,</span> <span class="nc">AnnotatedTypeMetadata</span> <span class="n">metadata</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p><code class="highlighter-rouge">ConditionContext</code>æ¥å£å¯ä»¥æ£€æŸ¥Beanï¼Œç¯å¢ƒå˜é‡ï¼Œèµ„æºï¼Œç±»ã€‚</p>
</blockquote>

<blockquote>
  <p><code class="highlighter-rouge">AnnotatedTypeMetadata</code>æ¥å£èƒ½æ£€æŸ¥å¸¦æœ‰<code class="highlighter-rouge">@Bean</code>æ³¨è§£çš„æ–¹æ³•ä¸Šè¿˜æœ‰ä»€ä¹ˆå…¶å®ƒæ³¨è§£ã€‚</p>
</blockquote>

<h2 id="å¤„ç†è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§">å¤„ç†è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§</h2>

<p>å½“åŒä¸€ä¸ªç±»å‹æœ‰å¤šä¸ªbeanè¢«åˆ›å»ºï¼Œç»„ä»¶æ‰«ææ— æ³•é€‰å–æ¥è£…é…ã€‚</p>

<blockquote>
  <p>springä¼šæŠ›å‡º<code class="highlighter-rouge">NoUniqueBeanDefinitionException</code>ã€‚</p>
</blockquote>

<h3 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h3>

<p>æœ‰2ç§å¤„ç†æ–¹æ³•ï¼š</p>

<ul>
  <li>åœ¨<code class="highlighter-rouge">@Component</code>æˆ–<code class="highlighter-rouge">@Bean</code>ä¸Šï¼Œä½¿ç”¨<code class="highlighter-rouge">@Primary</code>æ³¨è§£ï¼Œåœ¨é‡åˆ°æ­§ä¹‰æ—¶ï¼Œé€‰æ‹©é¦–é€‰çš„beanã€‚</li>
  <li>åœ¨<code class="highlighter-rouge">@Autowired</code>æˆ–<code class="highlighter-rouge">@Inject</code>ä¸Šï¼Œä½¿ç”¨<code class="highlighter-rouge">@Qualifier</code>é™å®šè¦æ³¨å…¥çš„beançš„<code class="highlighter-rouge">ID</code>ã€‚å½“æ³¨è§£åˆ°<code class="highlighter-rouge">@Component</code>æˆ–<code class="highlighter-rouge">@Bean</code>æ—¶ï¼Œåˆ™æ˜¯åˆ›å»ºè‡ªå·±çš„é™å®šç¬¦ï¼ˆç±»ä¼¼äºæ›´åbeançš„IDï¼‰ã€‚</li>
</ul>

<blockquote>
  <p><code class="highlighter-rouge">@Qualifier</code>é™å®šåç±»ä¼¼äºè®¾ç½®æ ‡ç­¾ç»™beanï¼Œspringä¼šè£…è½½æ»¡è¶³æ ‡ç­¾çš„beanã€‚</p>
</blockquote>

<blockquote>
  <p>ä¸ºäº†è®¾ç½®å¤šä¸ªæ ‡ç­¾ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰æ³¨è§£äº†<code class="highlighter-rouge">@Qualifier</code>çš„æ¥å£ï¼Œç”¨è‡ªå®šä¹‰æ³¨è§£ä½œä¸ºæ ‡ç­¾é™å®šã€‚ï¼ˆjava 8å…è®¸åœ¨å®šä¹‰æ³¨è§£ä¸Šæ·»åŠ <code class="highlighter-rouge">@Repeatable</code>å®ç°é‡å¤æ³¨è§£,ä¸è¿‡Springçš„<code class="highlighter-rouge">@Qualifier</code>å¹¶æ²¡æœ‰ä¸ºæ­¤æ·»åŠ é‡å¤æ³¨è§£åŠŸèƒ½ã€‚ï¼‰</p>
</blockquote>

<h3 id="é™„bynameå’Œbytype">é™„ï¼šbyNameå’ŒbyType</h3>

<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè™½ç„¶åˆ›å»ºçš„beanå’Œæ³¨å…¥çš„å‚æ•°åä¸ä¸€æ ·ï¼ˆæ­¤å¤„çš„beanå<code class="highlighter-rouge">message1</code>å’Œå‚æ•°å<code class="highlighter-rouge">message</code>ï¼‰ï¼Œä½†springä¼šä»¥<code class="highlighter-rouge">byType</code>çš„æ–¹å¼æ‰¾åˆ°ç±»å‹ç›¸åŒçš„beanè£…é…å¥½ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.*</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReaderConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Message</span> <span class="nf">message1</span><span class="o">(){</span>
        <span class="nc">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Message</span><span class="o">();</span>
        <span class="n">message</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">"---hi---1"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Reader</span> <span class="nf">reader</span><span class="o">(</span><span class="nc">Message</span> <span class="n">message</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Reader</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ä½†æœ‰å¤šä¸ªåŒç±»å‹çš„beanæ—¶ï¼Œå°±æ— æ³•ä¾èµ–<code class="highlighter-rouge">byType</code>æ‰¾åˆ°å¯¹åº”çš„beanï¼Œå¯ä»¥é€šè¿‡æ”¹å˜ä¼ å…¥çš„å‚æ•°åï¼ˆæ­¤å¤„æ”¹ç”¨å‚æ•°å<code class="highlighter-rouge">message2</code>ï¼‰ï¼Œé‡‡ç”¨<code class="highlighter-rouge">byName</code>æŒ‡å®šbeanã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.*</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReaderConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Message</span> <span class="nf">message1</span><span class="o">(){</span>
        <span class="nc">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Message</span><span class="o">();</span>
        <span class="n">message</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">"---hi---1"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Message</span> <span class="nf">message2</span><span class="o">(){</span>
        <span class="nc">Message</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Message</span><span class="o">();</span>
        <span class="n">message</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">"---hi---2"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Reader</span> <span class="nf">reader</span><span class="o">(</span><span class="nc">Message</span> <span class="n">message2</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Reader</span><span class="o">(</span><span class="n">message2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="æ³¨å…¥å¤–éƒ¨å€¼">æ³¨å…¥å¤–éƒ¨å€¼</h2>

<p>å¯ä»¥é€šè¿‡3ç§æ–¹å¼è·å–ç¯å¢ƒå€¼ï¼š</p>
<ul>
  <li>æ³¨å…¥å¹¶ä½¿ç”¨<code class="highlighter-rouge">Environment</code>ã€‚</li>
  <li>å±æ€§å ä½ç¬¦ï¼ˆproperty placeholderï¼‰ã€‚</li>
  <li>Springè¡¨è¾¾å¼è¯­è¨€<code class="highlighter-rouge">SpEL</code>ã€‚</li>
</ul>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#src/main/resources/application.properties
</span><span class="py">info.message</span><span class="p">=</span><span class="s">this is a message.</span>
<span class="py">info.counter</span><span class="p">=</span><span class="s">10</span>
</code></pre></div></div>

<p>Environmentï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.env.Environment</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"application.properties"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Message</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">Environment</span> <span class="n">env</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">print</span><span class="o">(){</span>
        <span class="nc">String</span> <span class="n">msgStr</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"info.message"</span><span class="o">,</span> <span class="s">"this is a msg"</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">msgInt</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"info.counter"</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">30</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>å±æ€§å ä½ç¬¦ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"application.properties"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Message</span> <span class="o">{</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${info.message}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">msg</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Spring ELï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"application.properties"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Message</span> <span class="o">{</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"#{systemProperties['info.message']}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">msg</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

:ET