I"¥t<h1 id="è¯·æ±‚è¿‡ç¨‹">è¯·æ±‚è¿‡ç¨‹</h1>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â†—â”‚ å¤„ç†å™¨æ˜ å°„â”‚
                         2/ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         /         3
<span class="err">è¯·æ±‚</span> 1 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” --------------------&gt; â”Œâ”€â”€â”€â”€â”€â”
<span class="gd">-----&gt;â”‚DispatcherServletâ”‚ &lt;--â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  4 â”‚æ§åˆ¶å™¨â”‚
</span>      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚æ¨¡å‹åŠé€»è¾‘è§†å›¾åâ”‚ ---â”‚     â”‚
                      \  \   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜
                       \  \5   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                       6\  ---&gt;â”‚è§†å›¾è§£æå™¨â”‚
                         â†˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            å“åº” 7      â”Œâ”€â”€â”€â”€â”
<span class="gd">&lt;----------------------â”‚è§†å›¾ â”‚
</span>                       â””â”€â”€â”€â”€â”˜
</code></pre></div></div>

<p>è¿‡ç¨‹ï¼š</p>

<ul>
  <li>è¯·æ±‚ï¼šè¯·æ±‚ç¦»å¼€æµè§ˆå™¨æ—¶ï¼Œä¼šå¸¦æœ‰ç”¨æˆ·æ‰€è¯·æ±‚å†…å®¹çš„ä¿¡æ¯ï¼Œè‡³å°‘ä¼šåŒ…å«è¯·æ±‚çš„URLã€‚ï¼ˆè¿˜å¯èƒ½å¸¦æœ‰å¦‚è¡¨å•ä¿¡æ¯ï¼‰</li>
  <li>DispatcherServletï¼šå°†è¯·æ±‚å‘é€ç»™Spring MVCæ§åˆ¶å™¨ï¼ˆcontrollerï¼‰</li>
</ul>

<blockquote>
  <ul>
    <li><code class="highlighter-rouge">DispatcherServlet</code>ï¼šä¸å¤§å¤šæ•°åŸºäºJavaçš„Webæ¡†æ¶ä¸€æ ·ï¼ŒSpring MVCæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šé€šè¿‡ä¸€ä¸ªå‰ç«¯æ§åˆ¶å™¨ï¼ˆfront controllerï¼‰Servletã€‚åœ¨è¿™é‡Œä¸€ä¸ªå•ä¾‹çš„Servletå°†è¯·æ±‚å§”æ‰˜ç»™åº”ç”¨ç¨‹åºçš„å…¶ä»–ç»„ä»¶æ¥æ‰§è¡Œå®é™…çš„å¤„ç†ã€‚åœ¨Spring MVCä¸­ï¼ŒDispatcherServletå°±æ˜¯å‰ç«¯æ§åˆ¶å™¨ã€‚</li>
    <li><code class="highlighter-rouge">DispatcherServlet</code>çš„ä»»åŠ¡æ˜¯å°†è¯·æ±‚å‘é€ç»™Spring MVCæ§åˆ¶å™¨ï¼ˆ<code class="highlighter-rouge">controller</code>ï¼‰ã€‚ï¼ˆæ§åˆ¶å™¨æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†è¯·æ±‚çš„Springç»„ä»¶ã€‚ï¼‰</li>
    <li><code class="highlighter-rouge">DispatcherServlet</code>éœ€è¦çŸ¥é“åº”è¯¥å°†è¯·æ±‚å‘é€ç»™å“ªä¸ªæ§åˆ¶å™¨ã€‚æ‰€ä»¥<code class="highlighter-rouge">DispatcherServlet</code>ä»¥ä¼šæŸ¥è¯¢ä¸€ä¸ªæˆ–å¤šä¸ª<code class="highlighter-rouge">å¤„ç†å™¨æ˜ å°„ï¼ˆhandler mapping</code>ï¼‰æ¥ç¡®å®šè¯·æ±‚çš„ä¸‹ä¸€ç«™åœ¨å“ªé‡Œã€‚å¤„ç†å™¨æ˜ å°„ä¼šæ ¹æ®è¯·æ±‚æ‰€æºå¸¦çš„URLä¿¡æ¯æ¥è¿›è¡Œå†³ç­–ã€‚</li>
    <li>åˆ°äº†æ§åˆ¶å™¨ï¼Œè¯·æ±‚ä¼šå¸ä¸‹è´Ÿè½½ï¼ˆç”¨æˆ·æäº¤çš„ä¿¡æ¯ï¼‰å¹¶è€å¿ƒç­‰å¾…æ§åˆ¶å™¨å¤„ç†è¿™äº›ä¿¡æ¯ã€‚ï¼ˆå®é™…ä¸Šï¼Œè®¾è®¡è‰¯å¥½çš„æ§åˆ¶å™¨æœ¬èº«åªå¤„ç†å¾ˆå°‘ç”šè‡³ä¸å¤„ç†å·¥ä½œï¼Œè€Œæ˜¯å°†ä¸šåŠ¡é€»è¾‘å§”æ‰˜ç»™ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å¯¹è±¡è¿›è¡Œå¤„ç†ï¼‰</li>
    <li>æ§åˆ¶å™¨åœ¨å®Œæˆé€»è¾‘å¤„ç†åï¼Œé€šå¸¸ä¼šäº§ç”Ÿä¸€äº›ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éœ€è¦è¿”å›ç»™ç”¨æˆ·å¹¶åœ¨æµè§ˆå™¨ä¸Šæ˜¾ç¤ºã€‚è¿™äº›ä¿¡æ¯è¢«ç§°ä¸ºæ¨¡å‹ï¼ˆ<code class="highlighter-rouge">model</code>ï¼‰ã€‚</li>
    <li>è¿™äº›ä¿¡æ¯é€šå¸¸éœ€è¦ä»¥ç”¨æˆ·å‹å¥½çš„æ–¹å¼è¿›è¡Œæ ¼å¼åŒ–ï¼Œä¸€èˆ¬ä¼šæ˜¯HTMLã€‚æ‰€ä»¥ä¿¡æ¯éœ€è¦å‘é€ç»™ä¸€ä¸ªè§†å›¾ï¼ˆ<code class="highlighter-rouge">view</code>ï¼‰ï¼Œé€šå¸¸ä¼šæ˜¯JSPã€‚</li>
  </ul>
</blockquote>

<blockquote>
  <ul>
    <li>æ§åˆ¶å™¨æ‰€åšçš„æœ€åä¸€ä»¶äº‹å°±æ˜¯å°†æ¨¡å‹æ•°æ®æ‰“åŒ…ï¼Œå¹¶ä¸”æ ‡è¯†å‡ºç”¨äºæ¸²æŸ“è¾“å‡ºçš„è§†å›¾åã€‚å®ƒæ¥ä¸‹æ¥ä¼šå°†è¯·æ±‚è¿åŒ<code class="highlighter-rouge">æ¨¡å‹</code>å’Œ<code class="highlighter-rouge">è§†å›¾å</code>å‘é€å›<code class="highlighter-rouge">DispatcherServlet</code>ã€‚</li>
    <li>ä¼ é€’ç»™<code class="highlighter-rouge">DispatcherServlet</code>çš„è§†å›¾åå¹¶ä¸ç›´æ¥è¡¨ç¤ºæŸä¸ªç‰¹å®šçš„JSPã€‚å®é™…ä¸Šå®ƒç”šè‡³ä¸èƒ½ç¡®å®šè§†å›¾å°±æ˜¯JSPã€‚ç›¸åï¼Œå®ƒä»…ä»…ä¼ é€’äº†ä¸€ä¸ª<code class="highlighter-rouge">é€»è¾‘åç§°</code>ï¼Œè¿™ä¸ªåå­—å°†ä¼šç”¨æ¥æŸ¥æ‰¾äº§ç”Ÿç»“æœçš„çœŸæ­£è§†å›¾ã€‚</li>
    <li><code class="highlighter-rouge">DispatcherServlet</code>å°†ä¼šä½¿ç”¨<code class="highlighter-rouge">è§†å›¾è§£æå™¨ï¼ˆview resolverï¼‰</code>æ¥å°†é€»è¾‘è§†å›¾ååŒ¹é…ä¸ºä¸€ä¸ªç‰¹å®šçš„è§†å›¾å®ç°ï¼Œå®ƒå¯èƒ½æ˜¯ä¹Ÿå¯èƒ½ä¸æ˜¯JSPã€‚</li>
    <li>è§†å›¾å°†ä¼šä½¿ç”¨æ¨¡å‹æ•°æ®æ¸²æŸ“è¾“å‡ºï¼Œè¿™ä¸ªè¾“å‡ºä¼šé€šè¿‡å“åº”å¯¹è±¡ä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚</li>
  </ul>
</blockquote>

<h1 id="é…ç½®dispatcherservlet">é…ç½®DispatcherServlet</h1>

<p><code class="highlighter-rouge">DispatcherServlet</code>å¯ä»¥é…ç½®åˆ°<code class="highlighter-rouge">web.xml</code>æ–‡ä»¶ä¸­ã€‚</p>

<h2 id="abstractannotationconfigdispatcherservletinitializer">AbstractAnnotationConfigDispatcherServletInitializer</h2>

<p>åœ¨Servlet 3è§„èŒƒå’ŒSpring 3.1ä¸­ï¼Œå¯ä»¥ä½¿ç”¨javaå°†<code class="highlighter-rouge">DispatcherServlet</code>é…ç½®åœ¨<code class="highlighter-rouge">Servletå®¹å™¨</code>ä¸­ï¼Œéœ€è¦ç»§æ‰¿<code class="highlighter-rouge">AbstractAnnotationConfigDispatcherServletInitializer</code>ï¼Œé‡å†™3ä¸ªæ–¹æ³•ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyWebAppInitializer</span> <span class="kd">extends</span> <span class="nc">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">getRootConfigClasses</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span> <span class="nc">RootConifg</span><span class="o">.</span><span class="na">class</span> <span class="o">};</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">getServletConfigClasses</span><span class="o">()</span> <span class="o">{</span>    <span class="c1">// æŒ‡å®šé…ç½®ç±»</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[]{</span> <span class="nc">WebConfig</span><span class="o">.</span><span class="na">class</span> <span class="o">};</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">String</span><span class="o">[]</span> <span class="nf">getServletMappings</span><span class="o">()</span> <span class="o">{</span>   <span class="c1">// å°†DispatcherServletæ˜ å°„åˆ°"/"</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span> <span class="s">"/"</span> <span class="o">};</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">getServletMappings()</code>ï¼šä¼šå°†ä¸€ä¸ªæˆ–å¤šä¸ªè·¯å¾„æ˜ å°„åˆ°<code class="highlighter-rouge">DispatcherServlet</code>ä¸Šã€‚æœ¬ä¾‹ä¸­ï¼Œå®ƒæ˜ å°„çš„æ˜¯â€<code class="highlighter-rouge">/</code>â€œï¼Œè¿™è¡¨ç¤ºå®ƒä¼šæ˜¯åº”ç”¨çš„é»˜è®¤Servletã€‚å®ƒä¼šå¤„ç†è¿›å…¥åº”ç”¨çš„æ‰€æœ‰è¯·æ±‚ã€‚</li>
  <li>è¦ç†è§£å¦2ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆè¦ç†è§£<code class="highlighter-rouge">DispatcherServlet</code>å’Œ<code class="highlighter-rouge">Servletç›‘å¬å™¨ï¼ˆContextLoaderListenerï¼‰</code>çš„å…³ç³»ã€‚ï¼ˆå¦‚ä¸‹ï¼‰</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    AbstractAnnotationConfigDispatcherServletInitializer
              |                            |
             åˆ›å»º                          åˆ›å»º
              |                            |
              v                            v
      DispatcherServlet               ContextLoaderListener
              |                            |
             åŠ è½½                          åŠ è½½
              |                            |
              v                            V
          åº”ç”¨ä¸Šä¸‹æ–‡                     åº”ç”¨ä¸Šä¸‹æ–‡
ï¼ˆæŸ¥æ‰¾@Configurationæ³¨è§£çš„ç±»ï¼Œ      ï¼ˆæŸ¥æ‰¾@Configurationæ³¨è§£çš„ç±»ï¼Œ
  åŠ è½½åŒ…å«Webç»„ä»¶çš„beanã€‚             åŠ è½½åº”ç”¨ä¸­çš„å…¶å®ƒbeanã€‚
  å¦‚æ§åˆ¶å™¨,è§†å›¾è§£æå™¨,å¤„ç†å™¨æ˜ å°„ç­‰ï¼‰     å¦‚è‡ªå®šä¹‰çš„ä¸šåŠ¡æ‰€éœ€çš„beanï¼‰

</code></pre></div></div>

<blockquote>
  <p><strong><code class="highlighter-rouge">AbstractAnnotationConfigDispatcherServletInitializer</code>å‰–æ</strong>ï¼š</p>
  <ul>
    <li>åœ¨Servlet 3.0ç¯å¢ƒä¸­ï¼Œå®¹å™¨ä¼šåœ¨ç±»è·¯å¾„ä¸­æŸ¥æ‰¾å®ç°<code class="highlighter-rouge">javax.servlet.ServletContainerInitializer</code>æ¥å£çš„ç±»ï¼Œå¦‚æœèƒ½å‘ç°çš„è¯ï¼Œå°±ä¼šç”¨å®ƒæ¥é…ç½®Servletå®¹å™¨ã€‚</li>
    <li>Springæä¾›äº†è¿™ä¸ªæ¥å£çš„å®ç°ï¼Œåä¸º<code class="highlighter-rouge">SpringServletContainerInitializer</code>ï¼Œè¿™ä¸ªç±»åè¿‡æ¥åˆä¼šæŸ¥æ‰¾å®ç°<code class="highlighter-rouge">WebApplicationInitializer</code>çš„ç±»å¹¶å°†é…ç½®çš„ä»»åŠ¡äº¤ç»™å®ƒä»¬æ¥å®Œæˆã€‚</li>
    <li>Spring 3.2å¼•å…¥äº†ä¸€ä¸ªä¾¿åˆ©çš„<code class="highlighter-rouge">WebApplicationInitializer</code>åŸºç¡€å®ç°ï¼Œä¹Ÿå°±æ˜¯<code class="highlighter-rouge">AbstractAnnotationConfigDispatcherServletInitializer</code>ã€‚</li>
    <li>å½“æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ç»§æ‰¿äº†<code class="highlighter-rouge">AbstractAnnotationConfigDispatcherServletInitializer</code>ï¼Œå½“éƒ¨ç½²åˆ°<code class="highlighter-rouge">Servlet 3.0å®¹å™¨</code>ä¸­çš„æ—¶å€™ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨å‘ç°å®ƒï¼Œå¹¶ç”¨æ¥é…ç½®<code class="highlighter-rouge">Servletä¸Šä¸‹æ–‡</code>ã€‚</li>
  </ul>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                        å®¹å™¨(Servlet 3.0)
                                |ç±»è·¯å¾„æŸ¥æ‰¾
                                v
            å®ç°javax.servlet.ServletContainerInitializeræ¥å£çš„ç±»
                                |
                                v
              SpringServletContainerInitializerï¼ˆSpringæä¾›ï¼‰
                                |æŸ¥æ‰¾
                                v
        å®ç°`WebApplicationInitializer`çš„ç±»ï¼Œå°†é…ç½®çš„ä»»åŠ¡äº¤ç»™å®ƒä»¬å®Œæˆ
                                |
                AbstractDispatcherServletInitializer
                  AbstractContextLoaderInitializer
                                |
                                v
    AbstractAnnotationConfigDispatcherServletInitializerï¼ˆSpringæä¾›ï¼‰
                                |
                                v
                  è‡ªå®šä¹‰ç±»ç»§æ‰¿ï¼Œå³å¯é…ç½®Servletä¸Šä¸‹æ–‡
</code></pre></div></div>

<h2 id="servleté…ç½®ç±»">Servleté…ç½®ç±»</h2>

<p>ä½œç”¨ï¼šå¯ç”¨Web MVCï¼Œå¯ç”¨ç»„ä»¶æ‰«æï¼Œé…ç½®è§†å›¾è§£æå™¨ï¼Œé…ç½®é™æ€èµ„æºçš„å¤„ç†ã€‚</p>

<p><code class="highlighter-rouge">WebConfig.java</code>åœ¨ä¸Šé¢<code class="highlighter-rouge">getServletConfigClasses()</code>æ–¹æ³•ä¸­è®¾ç½®ã€‚</p>

<p><strong>æœ€ç®€å•çš„é…ç½®</strong>ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableWebMvc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ç©ºé…ç½®çš„<code class="highlighter-rouge">WebConfig</code>å°½ç®¡èƒ½å¯ç”¨Spring MVCï¼Œä½†æœ‰ä¸å°‘é—®é¢˜ï¼š</p>

<ul>
  <li>æ²¡æœ‰é…ç½®è§†å›¾è§£æå™¨ã€‚Springé»˜è®¤ä¼šä½¿ç”¨<code class="highlighter-rouge">BeanNameVire-Resolver</code>ï¼Œè¿™ä¸ªè§†å›¾è§£æå™¨ä¼šæŸ¥æ‰¾IDä¸è§†å›¾åç§°åŒ¹é…çš„beanï¼Œå¹¶ä¸”æŸ¥æ‰¾beanè¦å®ç°Viewæ¥å£ï¼Œå®ƒä»¥è¿™æ ·çš„æ–¹å¼è§£æè§†å›¾ã€‚</li>
  <li>æ²¡æœ‰å¯ç”¨ç»„ä»¶æ‰«æã€‚Springåªèƒ½æ‰¾åˆ°æ˜¾å¼å£°æ˜åœ¨é…ç½®ç±»ä¸­çš„æ§åˆ¶å™¨ã€‚</li>
  <li><code class="highlighter-rouge">DispatcherServlet</code>ä¼šæ˜ å°„ä¸ºåº”ç”¨çš„é»˜è®¤Servletï¼Œæ‰€ä»¥å®ƒä¼šå¤„ç†æ‰€æœ‰è¯·æ±‚ï¼ŒåŒ…æ‹¬å¯¹é™æ€èµ„æºçš„è¯·æ±‚ã€‚</li>
</ul>

<p><strong>æœ€å°ä½†å¯ç”¨çš„Spring MVCé…ç½®</strong>ï¼š</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ViewResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.view.InternalResourceViewResolver</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableWebMvc</span>       <span class="c1">// å¯ç”¨Spring MVC</span>
<span class="nd">@ComponentScan</span>      <span class="c1">// å¯ç”¨ç»„ä»¶æ‰«æ</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">extends</span> <span class="nc">WebMvcConfigurationSupport</span> <span class="o">{</span>

    <span class="c1">// é…ç½®JSPè§†å›¾è§£æå™¨</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ViewResolver</span> <span class="nf">viewResolver</span><span class="o">(){</span>
        <span class="nc">InternalResourceViewResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">InternalResourceViewResolver</span><span class="o">();</span>
        <span class="n">resolver</span><span class="o">.</span><span class="na">setPrefix</span><span class="o">(</span><span class="s">"/WEB-INF/jsp/"</span><span class="o">);</span>
        <span class="n">resolver</span><span class="o">.</span><span class="na">setSuffix</span><span class="o">(</span><span class="s">".jsp"</span><span class="o">);</span>
        <span class="n">resolver</span><span class="o">.</span><span class="na">setExposeContextBeansAsAttributes</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">resolver</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// é…ç½®é™æ€èµ„æºçš„å¤„ç†</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureDefaultServletHandling</span><span class="o">(</span><span class="nc">DefaultServletHandlerConfigurer</span> <span class="n">configurer</span><span class="o">){</span>
        <span class="n">configurer</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">@ComponentScan</code>ä¼šæ‰¾åˆ°å¸¦æœ‰<code class="highlighter-rouge">@Controller</code>æ³¨è§£çš„ç±»ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨é…ç½®ç±»ä¸­æ˜¾å¼å£°æ˜æ§åˆ¶å™¨ã€‚</p>

<p><code class="highlighter-rouge">ViewResolver</code>ä¼šæŒ‰ç…§è®¾å®šçš„å‰åç¼€æŸ¥æ‰¾JSPæ–‡ä»¶ã€‚</p>

<p><code class="highlighter-rouge">configureDefaultServletHandling()</code>æ–¹æ³•é€šè¿‡è°ƒç”¨<code class="highlighter-rouge">DefaultServletHandlerConfigurer</code>çš„<code class="highlighter-rouge">enable()</code>æ–¹æ³•ï¼Œè¦æ±‚<code class="highlighter-rouge">DispatcherServlet</code>å°†å¯¹é™æ€èµ„æºçš„è¯·æ±‚è½¬å‘åˆ°<code class="highlighter-rouge">Servletå®¹å™¨</code>ä¸­é»˜è®¤çš„Servletä¸Šï¼Œè€Œä¸æ˜¯<code class="highlighter-rouge">DispatcherServlet</code>æœ¬èº«æ¥å¤„ç†æ­¤ç±»è¦æ±‚ã€‚</p>

<h2 id="rooté…ç½®ç±»">Rooté…ç½®ç±»</h2>

<p>ä½œç”¨ï¼šåŠ è½½è‡ªå®šä¹‰çš„ä¸šåŠ¡ç»„ä»¶ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.yww.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan.Filter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.FilterType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span>
        <span class="n">basePackages</span> <span class="o">=</span> <span class="o">{</span><span class="s">"com.yww"</span><span class="o">},</span>
        <span class="n">excludeFilters</span> <span class="o">=</span> <span class="o">{</span><span class="nd">@Filter</span><span class="o">(</span><span class="n">type</span><span class="o">=</span> <span class="nc">FilterType</span><span class="o">.</span><span class="na">ANNOTATION</span><span class="o">,</span> <span class="n">value</span> <span class="o">=</span> <span class="nc">EnableWebMvc</span><span class="o">.</span><span class="na">class</span><span class="o">)}</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RootConfig</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>

<h1 id="webxmlä¸­å£°æ˜dispatcherservlet">web.xmlä¸­å£°æ˜DispatcherServlet</h1>

<blockquote>
  <p>ä½¿ç”¨javaé…ç½®çš„æ–¹å¼ï¼Œ<code class="highlighter-rouge">AbstractAnnotationConfigDispatcherServletInitializer</code>ä¼šè‡ªåŠ¨æ³¨å†Œ<code class="highlighter-rouge">DispatcherServlet</code>å’Œ<code class="highlighter-rouge">ContextLoaderListener</code>ã€‚è€Œä½¿ç”¨web.xmlé…ç½®ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ã€‚</p>
</blockquote>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- web.xml --&gt;</span>
<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns=</span><span class="s">"http://xmlns.jcp.org/xml/ns/javaee"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span>
         <span class="na">version=</span><span class="s">"4.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;context-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>/WEB-INF/applicationContext.xml<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/context-param&gt;</span>

    <span class="nt">&lt;listener&gt;</span>
        <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>

    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>dispatcher<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>dispatcher<span class="nt">&lt;/servlet-name&gt;</span>
<span class="c">&lt;!--        &lt;url-pattern&gt;*.form&lt;/url-pattern&gt;--&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">ContextLoaderListener</code>å’Œ<code class="highlighter-rouge">DispatcherServlet</code>å‰é¢æåˆ°è¿‡ï¼Œå®ƒä»¬å„è‡ªä¼šåŠ è½½ä¸€ä¸ªSpringåº”ç”¨ä¸Šä¸‹æ–‡ã€‚</p>

<ul>
  <li>
    <p><strong><code class="highlighter-rouge">ContextLoaderListener</code></strong>ï¼šä¸Šä¸‹æ–‡å‚æ•°<code class="highlighter-rouge">contextConfigLocation</code>æŒ‡å®šäº†ä¸€ä¸ªXMLæ–‡ä»¶çš„åœ°å€ï¼Œè¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†æ ¹åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå®ƒä¼šè¢«<code class="highlighter-rouge">ContextLoaderListener</code>åŠ è½½ã€‚æ ¹ä¸Šä¸‹æ–‡ä¼šä»<code class="highlighter-rouge">/WEB-INF/applicationContext.xml</code>ä¸­åŠ è½½beanå®šä¹‰ã€‚</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">DispatcherServlet</code></strong>ï¼š<code class="highlighter-rouge">DispatcherServlet</code>ä¼šæ ¹æ®Servletçš„åå­—æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶åŸºäºè¯¥æ–‡ä»¶åŠ è½½åº”ç”¨ä¸Šä¸‹æ–‡ã€‚è¿™é‡ŒServletçš„åå­—ä¸º<code class="highlighter-rouge">dispatcher</code>ï¼Œå› æ­¤<code class="highlighter-rouge">DispatcherServlet</code>ä¼šä»<code class="highlighter-rouge">/WEB-INF/dispatcher-servlet.xml</code>æ–‡ä»¶ä¸­åŠ è½½å…¶åº”ç”¨ä¸Šä¸‹æ–‡ã€‚ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨<code class="highlighter-rouge">&lt;init-param&gt;</code>æŒ‡å®šæ–‡ä»¶ä½ç½®ã€‚å¦‚ä¸‹ï¼‰</p>
  </li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>dispatcher<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>/WEB-INF/spring/servlet-context.xml<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>
</code></pre></div></div>

<h1 id="é…ç½®dispatcherservlet-æ›´å¤š">é…ç½®DispatcherServlet æ›´å¤š</h1>
<p>åœ¨<code class="highlighter-rouge">AbstractAnnotationConfigDispatcherServletInitializer</code>å°†<code class="highlighter-rouge">DispatcherServlet</code>æ³¨å†Œåˆ°<code class="highlighter-rouge">Servletå®¹å™¨</code>ä¸­ä¹‹åï¼Œå°±ä¼šè°ƒç”¨<code class="highlighter-rouge">customizeRegistration()</code>ï¼Œå¹¶å°†Servletæ³¨å†Œåå¾—åˆ°çš„<code class="highlighter-rouge">Registration.Dynamic</code>ä¼ é€’è¿›æ¥ã€‚é€šè¿‡é‡è½½<code class="highlighter-rouge">customizeRegistration()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹<code class="highlighter-rouge">DispatcherServlet</code>è¿›è¡Œé¢å¤–çš„é…ç½®ã€‚</p>

<blockquote>
  <p>å¯ç”¨äºå¼€å¯å¯¹<code class="highlighter-rouge">multipartè¯·æ±‚</code>å’Œ<code class="highlighter-rouge">æ–‡ä»¶ä¸Šä¼ </code>ç­‰ã€‚</p>
</blockquote>

<h2 id="æ·»åŠ å…¶å®ƒçš„servletå’Œfilter">æ·»åŠ å…¶å®ƒçš„Servletå’ŒFilter</h2>
<p><code class="highlighter-rouge">AbstractAnnotationConfigDispatcherServletInitializer</code>ä¼šåˆ›å»º<code class="highlighter-rouge">DispatcherServlet</code>å’Œ<code class="highlighter-rouge">ContextLoaderListener</code>ã€‚</p>

<p>å¦‚æœè‡ªå·±æƒ³åˆ›å»º<code class="highlighter-rouge">Servlet</code>,<code class="highlighter-rouge">Filter</code>,<code class="highlighter-rouge">Listener</code>ï¼Œï¼ˆå°±æ˜¯å¾€<code class="highlighter-rouge">Webå®¹å™¨</code>ä¸­æ³¨å†Œå…¶å®ƒç»„ä»¶ï¼‰ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„åˆå§‹åŒ–å™¨å°±å¯ä»¥äº†ã€‚æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å®ç°Springçš„<code class="highlighter-rouge">WebApplicationInitializer</code>æ¥å£ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MyServletInitializer.java</span>
<span class="kn">package</span> <span class="nn">com.yww.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.WebApplicationInitializer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyServletInitializer</span> <span class="kd">implements</span> <span class="nc">WebApplicationInitializer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStartup</span><span class="o">(</span><span class="nc">ServletContext</span> <span class="n">servletContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="c1">// æ³¨å†ŒServlet</span>
        <span class="n">javax</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">ServletRegistration</span><span class="o">.</span><span class="na">Dynamic</span> <span class="n">myServlet</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">addServlet</span><span class="o">(</span><span class="s">"myServlet"</span><span class="o">,</span> <span class="nc">MyServlet</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">myServlet</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="s">"/custom/**"</span><span class="o">);</span>

        <span class="c1">// æ³¨å†ŒFilter</span>
        <span class="n">javax</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">FilterRegistration</span><span class="o">.</span><span class="na">Dynamic</span> <span class="n">myFilter</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="s">"myFilter"</span><span class="o">,</span> <span class="nc">MyFilter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="c1">//        myFilter.addMappingForServletNames(null, false, "myServlet");</span>
        <span class="n">myFilter</span><span class="o">.</span><span class="na">addMappingForUrlPatterns</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="s">"/custom/*"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å¦‚æœåªæ˜¯æ³¨å†Œ<code class="highlighter-rouge">Filter</code>ï¼Œå¹¶ä¸”è¯¥<code class="highlighter-rouge">Filter</code>åªä¼šæ˜ å°„åˆ°<code class="highlighter-rouge">DispatcherServlet</code>ä¸Šçš„è¯ã€‚å¯ä»¥é‡è½½<code class="highlighter-rouge">AbstractAnnotationConfigDispatcherServletInitializer</code>çš„<code class="highlighter-rouge">getServletFilters()</code>æ–¹æ³•ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MyWebAppInitializer.java</span>
<span class="kn">package</span> <span class="nn">com.yww.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.Filter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyWebAppInitializer</span> <span class="kd">extends</span> <span class="nc">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="nc">Filter</span><span class="o">[]</span> <span class="nf">getServletFilters</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">Filter</span><span class="o">[]{</span> <span class="k">new</span> <span class="nc">MyFilter</span><span class="o">()};</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
:ET