<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="你根本不知道你什么都不知道">
<meta property="og:type" content="website">
<meta property="og:title" content="枫の故事">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="枫の故事">
<meta property="og:description" content="你根本不知道你什么都不知道">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="dejiang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>枫の故事</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">枫の故事</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">纸上得来终觉浅，绝知此事要恭行</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<!--
<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
-->
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/18/electronic/ros/ros-demo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dejiang">
      <meta itemprop="description" content="你根本不知道你什么都不知道">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫の故事">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/18/electronic/ros/ros-demo/" class="post-title-link" itemprop="url">[ros] demo</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-01-18 13:21:00 / 修改时间：16:24:46" itemprop="dateCreated datePublished" datetime="2020-01-18T13:21:00+08:00">2020-01-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/electronic/" itemprop="url" rel="index">
                    <span itemprop="name">electronic</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/electronic/ros/" itemprop="url" rel="index">
                    <span itemprop="name">ros</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>创建一个接受图片数据，发布数值数据的rospy程序。</p>
<h1 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">└── src</span><br><span class="line">    ├── CMakeLists.txt -&gt; &#x2F;opt&#x2F;ros&#x2F;melodic&#x2F;share&#x2F;catkin&#x2F;cmake&#x2F;toplevel.cmake</span><br><span class="line">    └── demo</span><br><span class="line">        ├── CMakeLists.txt</span><br><span class="line">        ├── msg</span><br><span class="line">        │   └── Detection.msg</span><br><span class="line">        ├── package.xml</span><br><span class="line">        ├── scripts</span><br><span class="line">        │   └── detect.py</span><br><span class="line">        └── src</span><br></pre></td></tr></table></figure>
<h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p catkin_ws/src</span><br><span class="line"><span class="built_in">cd</span> catkin_ws/src</span><br><span class="line">catkin_create_pkg demo rospy std_msgs message_generation</span><br><span class="line"><span class="built_in">cd</span> demo</span><br></pre></td></tr></table></figure>
<blockquote>
<p>message_generation：用于msg文件生成代码，以便用于后续直接导入。（可以在<code>devel/lib/python2.7/dist-packages/demo/msg/_Detection.py</code>或<code>devel/include/demo/Detection.h</code>看到生成的代码文件。）</p>
</blockquote>
<h2 id="添加msg文件"><a href="#添加msg文件" class="headerlink" title="添加msg文件"></a>添加msg文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p msg/</span><br><span class="line">vim msg/Detection.msg</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">float32[] pos</span><br><span class="line">uint32 classes</span><br><span class="line">float32 scores</span><br></pre></td></tr></table></figure>
<h2 id="修改CMakeLists-txt"><a href="#修改CMakeLists-txt" class="headerlink" title="修改CMakeLists.txt"></a>修改CMakeLists.txt</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim CMakeLists.txt</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## Generate messages in the &#39;msg&#39; folder</span><br><span class="line">add_message_files(</span><br><span class="line">  FILES</span><br><span class="line">  Detection.msg</span><br><span class="line">#   Message1.msg</span><br><span class="line">#   Message2.msg</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## Generate added messages and services with any dependencies listed here</span><br><span class="line">generate_messages(</span><br><span class="line">  DEPENDENCIES</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir scripts/</span><br><span class="line">vim scripts/detect.py</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> demo.msg <span class="keyword">import</span> Detection  <span class="comment"># generate_messages的作用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Detect</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        rospy.init_node(<span class="string">'image_detect_node'</span>)</span><br><span class="line">        rospy.Subscriber(<span class="string">'/image_raw'</span>, Image, self.callback)</span><br><span class="line">        <span class="comment"># rospy.Subscriber('/camera/color/image_raw', Image, self.callback)</span></span><br><span class="line">        self.pub = rospy.Publisher(<span class="string">'image_detection'</span>, Detection , queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(self, image)</span>:</span></span><br><span class="line">        img = np.frombuffer(image.data, dtype=np.uint8).reshape((<span class="number">480</span>, <span class="number">640</span>, <span class="number">3</span>))</span><br><span class="line">        <span class="comment"># rospy.loginfo(img)</span></span><br><span class="line">        self.pub.publish(Detection([<span class="number">1.</span>, <span class="number">2.</span>], <span class="number">10</span>, <span class="number">2.</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">        rospy.spin()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    Detect().start()</span><br></pre></td></tr></table></figure>
<h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><p>需要为python文件添加可执行权限：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x detect.py</span><br></pre></td></tr></table></figure></p>
<p>编译：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">catkin_make all clean</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure></p>
<p>执行：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun demo detect.py</span><br></pre></td></tr></table></figure></p>
<p>查看返回数据：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rostopic <span class="built_in">echo</span> /image_detection</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/02/electronic/ros/ros-remote/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dejiang">
      <meta itemprop="description" content="你根本不知道你什么都不知道">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫の故事">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/02/electronic/ros/ros-remote/" class="post-title-link" itemprop="url">[ros] 远程连接</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-01-02 15:00:00 / 修改时间：15:28:22" itemprop="dateCreated datePublished" datetime="2020-01-02T15:00:00+08:00">2020-01-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/electronic/" itemprop="url" rel="index">
                    <span itemprop="name">electronic</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/electronic/ros/" itemprop="url" rel="index">
                    <span itemprop="name">ros</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="远程节点"><a href="#远程节点" class="headerlink" title="远程节点"></a>远程节点</h1><p>为了远程接入roscore，只需要简单配置环境变量。</p>
<div class="tabs" id="env"><ul class="nav-tabs"><li class="tab active"><a href="#env-1">master</a></li><li class="tab"><a href="#env-2">other computer</a></li></ul><div class="tab-content"><div class="tab-pane active" id="env-1"><p><code>ROS_HOSTNAME</code>设置为执行roscore主节点的ip：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ROS_HOSTNAME=192.168.0.100</span><br><span class="line"><span class="built_in">export</span> ROS_MASTER_URI=http://<span class="variable">$&#123;ROS_HOSTNAME&#125;</span>:11311</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="env-2"><p>仅接受master的数据：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ROS_MASTER_URI=http://192.168.0.100:11311</span><br></pre></td></tr></table></figure>
如果需要发送数据到master，需要指定自身的ip：
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ROS_MASTER_URI=http://192.168.0.100:11311</span><br><span class="line"><span class="built_in">export</span> ROS_HOSTNAME=192.168.0.101</span><br></pre></td></tr></table></figure></div></div></div>
<h1 id="远程摄像头"><a href="#远程摄像头" class="headerlink" title="远程摄像头"></a>远程摄像头</h1><div class="tabs" id="camera"><ul class="nav-tabs"><li class="tab active"><a href="#camera-1">master</a></li><li class="tab"><a href="#camera-2">other computer</a></li></ul><div class="tab-content"><div class="tab-pane active" id="camera-1"><p>按照上述远程节点的方式配置后，在master上执行：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">roscore</span><br><span class="line">rosrun uvc_camera uvc_camera_node</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="camera-2"><p>安装uvc摄像头相关库：</p>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-melodic-uvc-camera</span><br></pre></td></tr></table></figure><br>插入uvc摄像头，赋予读取设备权限：</p>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 777 /dev/ttyUSB0</span><br></pre></td></tr></table></figure><br>在其它计算机上执行：</p>
<p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun image_view image_view image:=/image_raw</span><br></pre></td></tr></table></figure><br>或使用rqt可视化。</p></div></div></div>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/29/electronic/arduino/arduino-rosserial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dejiang">
      <meta itemprop="description" content="你根本不知道你什么都不知道">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫の故事">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/29/electronic/arduino/arduino-rosserial/" class="post-title-link" itemprop="url">[arduino] rosserial</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-29 18:16:00" itemprop="dateCreated datePublished" datetime="2019-12-29T18:16:00+08:00">2019-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-02 13:31:14" itemprop="dateModified" datetime="2020-01-02T13:31:14+08:00">2020-01-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/electronic/" itemprop="url" rel="index">
                    <span itemprop="name">electronic</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/electronic/arduino/" itemprop="url" rel="index">
                    <span itemprop="name">arduino</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h1><p>下载arduino：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install arduino</span><br></pre></td></tr></table></figure></p>
<p>安装rosserial：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-melodic-rosserial ros-melodic-rosserial-server ros-melodic-rosserial-arduino ros-melodic-rosserial-python</span><br></pre></td></tr></table></figure></p>
<p>为了在Arduino中使用它,需要创建一个用于Arduino的rosserial库：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/Arduino/libraries/</span><br><span class="line">rm -rf ros_lib</span><br><span class="line">rosrun rosserial_arduino make_libraries.py .</span><br></pre></td></tr></table></figure></p>
<h1 id="arduino"><a href="#arduino" class="headerlink" title="arduino"></a>arduino</h1><h2 id="subscriber"><a href="#subscriber" class="headerlink" title="subscriber"></a>subscriber</h2><p>arduino接受发布在/led_out的数据，控制pin8引脚的电平开关。</p>
<h3 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h3><p>使用的是arduino pro mini 328p版，发现168p版本存储不够。</p>
<p><img src="/2019/12/29/electronic/arduino/arduino-rosserial/1.png" alt="ros_sub"></p>
<blockquote>
<p>DTR用于在上传程序时自动RESET板子，否则需要在上传时手动按一下板子上的RESET按键（时机需要自己把握，比较麻烦）。</p>
</blockquote>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;std_msgs/Byte.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(<span class="keyword">const</span> std_msgs::Byte&amp; led_msg)</span></span>&#123;</span><br><span class="line">  <span class="built_in">digitalWrite</span>(<span class="number">8</span>, led_msg.data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ros::NodeHandle nh;</span><br><span class="line">ros::Subscriber&lt;std_msgs::Byte&gt; sub(<span class="string">"led_out"</span>, <span class="built_in">process</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// put your setup code here, to run once:</span></span><br><span class="line">  <span class="built_in">pinMode</span>(<span class="number">8</span>, <span class="literal">OUTPUT</span>);</span><br><span class="line"></span><br><span class="line">  nh.initNode();</span><br><span class="line">  nh.subscribe(sub);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></span><br><span class="line">  nh.spinOnce();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>arduino上传程序需要/dev/ttyUSB0的权限。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 777 /dev/ttyUSB0</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><ul>
<li>启动ros服务</li>
<li>启动rosserial服务</li>
<li>查看msg数据</li>
<li>发送数据</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">roscore</span><br><span class="line"></span><br><span class="line">rosrun rosserial_python serial_node.py _port:=/dev/ttyUSB0</span><br><span class="line"></span><br><span class="line">rostopic <span class="built_in">echo</span> /led_out</span><br><span class="line"></span><br><span class="line">rostopic pub -1 /led_out std_msgs/Byte 1</span><br></pre></td></tr></table></figure>
<p>发送数字1打开小灯（非1即可），发送数字0关闭。</p>
<blockquote>
<p><code>rosserial_python</code>可通过_port指定设备，通过_baud指定波特率（书中是115200并不能成功连接，改为57600后成功，后改为不设置可以自动设置）。<br>rostopic pub <topic-name> <topic-type> [data…]<br><code>rostopic pub</code>中-1是执行一次。</topic-type></topic-name></p>
</blockquote>
<p><a href="http://wiki.ros.org/rosserial/" target="_blank" rel="noopener">rosserial</a><br><a href="http://wiki.ros.org/rostopic" target="_blank" rel="noopener">rostopic</a></p>
<h2 id="publisher"><a href="#publisher" class="headerlink" title="publisher"></a>publisher</h2><p>用引线将VCC/GND输入pin9，将pin8输出电平值。</p>
<p>arduino发送pin9引脚的值到/led_out。</p>
<h3 id="硬件-1"><a href="#硬件-1" class="headerlink" title="硬件"></a>硬件</h3><p><img src="/2019/12/29/electronic/arduino/arduino-rosserial/2.png" alt="ros_pub"></p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;std_msgs/Byte.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">ros::NodeHandle nh;</span><br><span class="line">std_msgs::Byte led_msg;</span><br><span class="line">ros::<span class="function">Publisher <span class="title">pub</span><span class="params">(<span class="string">"led_out"</span>, &amp;led_msg)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// put your setup code here, to run once:</span></span><br><span class="line">  nh.initNode();</span><br><span class="line">  nh.advertise(pub);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">pinMode</span>(<span class="number">8</span>, <span class="literal">OUTPUT</span>);</span><br><span class="line">  <span class="built_in">pinMode</span>(<span class="number">9</span>, <span class="literal">INPUT</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></span><br><span class="line">  <span class="keyword">uint8_t</span> reading = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">uint32_t</span> pre_time;</span><br><span class="line"></span><br><span class="line">  reading = <span class="built_in">digitalRead</span>(<span class="number">9</span>);</span><br><span class="line">  <span class="built_in">digitalWrite</span>(<span class="number">8</span>, reading);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">millis</span>() - pre_time &gt;= <span class="number">50</span>)&#123;</span><br><span class="line">    led_msg.data = reading;</span><br><span class="line">    pub.publish(&amp;led_msg);</span><br><span class="line">    pre_time = <span class="built_in">millis</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  nh.spinOnce();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><ul>
<li>启动ros服务</li>
<li>启动rosserial服务</li>
<li>查看msg数据</li>
<li>输入电平到输入引脚</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">roscore</span><br><span class="line"></span><br><span class="line">rosrun rosserial_python serial_node.py _port:=/dev/ttyUSB0</span><br><span class="line"></span><br><span class="line">rostopic <span class="built_in">echo</span> /led_out</span><br></pre></td></tr></table></figure>
<p>将引脚VCC/GND引到pin9。</p>
<p>在pc，<code>rostopic echo</code>命令的终端可以看到来自板子的/led_out数据。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/22/deep_learning/paper/paper-SSD-Single-Shot-MultiBox-Detector/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dejiang">
      <meta itemprop="description" content="你根本不知道你什么都不知道">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫の故事">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/22/deep_learning/paper/paper-SSD-Single-Shot-MultiBox-Detector/" class="post-title-link" itemprop="url">[paper] SSD: Single Shot MultiBox Detector</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-22 15:59:00" itemprop="dateCreated datePublished" datetime="2019-12-22T15:59:00+08:00">2019-12-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-01-09 23:41:05" itemprop="dateModified" datetime="2020-01-09T23:41:05+08:00">2020-01-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/deep-learning/" itemprop="url" rel="index">
                    <span itemprop="name">deep learning</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><ul>
<li>在原图上做假设边界框，需要太多计算。</li>
<li>对标YOLO，同是Single Shot，精度和速度更好。</li>
</ul>
<h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><blockquote>
<ul>
<li>SSD：300x300分辨率，74.3% mAP，59 FPS。（VOC2007数据集）</li>
<li>YOLO：300x300分辨率，63.4% mAP，45 FPS。（VOC2007数据集）</li>
</ul>
</blockquote>
<p>『目标检测网络速度精度对比』<br><img src="/2019/12/22/deep_learning/paper/paper-SSD-Single-Shot-MultiBox-Detector/2.png" alt="速度精度"></p>
<p>『SSD512识别COCO数据集』<br><img src="/2019/12/22/deep_learning/paper/paper-SSD-Single-Shot-MultiBox-Detector/4.png" alt="SSD检测效果"></p>
<h1 id="贡献"><a href="#贡献" class="headerlink" title="贡献"></a>贡献</h1><ul>
<li>1.<strong>使用不同比例的特征图预测。</strong></li>
<li>2.<strong>使用卷积分类。</strong></li>
<li>3.速度比yolo快。</li>
<li>4.端到端，高速度和精度。</li>
<li>5.对比试验。</li>
</ul>
<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><p>『使用的是VGG16』<br><img src="/2019/12/22/deep_learning/paper/paper-SSD-Single-Shot-MultiBox-Detector/1.png" alt="net"></p>
<p>『MultiBox是如何在feature map上操作』<br><img src="/2019/12/22/deep_learning/paper/paper-SSD-Single-Shot-MultiBox-Detector/3.png" alt="MultiBox"></p>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><h2 id="多个比例特征图识别-Multi-scale-feature-maps-for-detection"><a href="#多个比例特征图识别-Multi-scale-feature-maps-for-detection" class="headerlink" title="多个比例特征图识别 (Multi-scale feature maps for detection)"></a>多个比例特征图识别 (Multi-scale feature maps for detection)</h2><p>渐近的减小特征图的尺寸，使用不同尺寸的特征图做预测。（6层）</p>
<blockquote>
<p>YOLO只操作单一尺寸的特征图。</p>
</blockquote>
<h2 id="卷积预测分类-Convolutional-predictors-for-detection"><a href="#卷积预测分类-Convolutional-predictors-for-detection" class="headerlink" title="卷积预测分类 (Convolutional predictors for detection)"></a>卷积预测分类 (Convolutional predictors for detection)</h2><p>对于$m \times n$尺寸$p$通道的特征图，使用卷积核为其分类打分。</p>
<blockquote>
<p>YOLO使用全连接做预测分类。</p>
</blockquote>
<h2 id="默认框，长宽比-Default-boxes-and-aspect-ratios"><a href="#默认框，长宽比-Default-boxes-and-aspect-ratios" class="headerlink" title="默认框，长宽比 (Default boxes and aspect ratios)"></a>默认框，长宽比 (Default boxes and aspect ratios)</h2><p>设有c个分类，其中背景也算一类。</p>
<p>特征图分为$m \times n$尺寸的单元，每个单元有k个默认框（k种不同比例大小的框）。</p>
<p>每个单元有4个位置偏移值$\Delta(c x, c y, w, h)$。</p>
<p>于是总共有$(c+4) k$个过滤器，对于$m \times n$尺寸的特征图，共有$(c+4) k m n$个输出。</p>
<blockquote>
<p>SSD预测输出的是对这个默认框的偏移量，为的是使用合适大小的边框框出对象。</p>
<p>论文中的默认框(default box)，按理解，应该是预置的边界框，类似滑动窗口的窗口。</p>
<p>本文中的默认框与Faster R-CNN中的anchor boxes相似。然而本文应用它们到几个不同分辨率的特征图。</p>
</blockquote>
<h1 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h1><h2 id="匹配策略-Matching-strategy"><a href="#匹配策略-Matching-strategy" class="headerlink" title="匹配策略 (Matching strategy)"></a>匹配策略 (Matching strategy)</h2><p>匹配默认框和标签的jaccard重合度(iou)大于阈值(0.5)。</p>
<h2 id="损失函数-Training-objective"><a href="#损失函数-Training-objective" class="headerlink" title="损失函数 (Training objective)"></a>损失函数 (Training objective)</h2><h3 id="总损失"><a href="#总损失" class="headerlink" title="总损失"></a>总损失</h3><script type="math/tex; mode=display">
L(x, c, l, g)=\frac{1}{N}\left(L_{\operatorname{conf}}(x, c)+\alpha L_{\operatorname{loc}}(x, l, g)\right)</script><p>L = 定位损失(loc) + 置信度损失(conf)。</p>
<blockquote>
<ul>
<li>N:默认框匹配(iou&gt;0.5)的正样本数量。</li>
<li>c:置信度预测值。（分类类别的概率）</li>
<li>l:预测框位置（预测相对于默认框偏移量）。</li>
<li>g:位置标签。</li>
<li>$\alpha$:权值系数。</li>
</ul>
</blockquote>
<h3 id="定位损失"><a href="#定位损失" class="headerlink" title="定位损失"></a>定位损失</h3><p>定位使用的是L1损失，多分类使用的是softmax损失。</p>
<p>L1损失：</p>
<script type="math/tex; mode=display">
L_{l o c}(x, l, g)=\sum_{i \in P o s}^{N} \sum_{m \in\{c x, c y, w, h\}} x_{i j}^{k} \operatorname{smooth}_{L 1}\left(l_{i}^{m}-\hat{g}_{j}^{m}\right)</script><blockquote>
<p>$x_{i j}^{p}={1,0}$：匹配第i个默认框与p类第j个标签框的指示器。</p>
<p>使用L1而不是L2是为了2方面限制梯度：</p>
<ul>
<li>当默认框与标签框差别过大时，梯度值不至于过大。</li>
<li>当默认框与标签框差别过小时，梯度值足够小。</li>
</ul>
</blockquote>
<h3 id="分类损失"><a href="#分类损失" class="headerlink" title="分类损失"></a>分类损失</h3><p>softmax损失：</p>
<script type="math/tex; mode=display">
L_{c o n f}(x, c)=-\sum_{i \in P o s}^{N} x_{i j}^{p} \log \left(\hat{c}_{i}^{p}\right)-\sum_{i \in N e g} \log \left(\hat{c}_{i}^{0}\right) \quad \text { where } \quad \hat{c}_{i}^{p}=\frac{\exp \left(c_{i}^{p}\right)}{\sum_{p} \exp \left(c_{i}^{p}\right)}</script><blockquote>
<p>与Faster R-CNN相似，预测的是默认框中心$(c x, c y)$和宽高$(w, h)$的偏移量。</p>
</blockquote>
<h3 id="偏移量计算"><a href="#偏移量计算" class="headerlink" title="偏移量计算"></a>偏移量计算</h3><p>偏移量的计算公式：</p>
<script type="math/tex; mode=display">
\begin{aligned}
\hat{g}_{j}^{c x}=\left(g_{j}^{c x}-d_{i}^{c x}\right) / d_{i}^{w} & \quad \hat{g}_{j}^{c y}=\left(g_{j}^{c y}-d_{i}^{c y}\right) / d_{i}^{h} \\
\hat{g}_{j}^{w}=\log \left(\frac{g_{j}^{w}}{d_{i}^{w}}\right) & \quad \hat{g}_{j}^{h}=\log \left(\frac{g_{j}^{h}}{d_{i}^{h}}\right)
\end{aligned}</script><h2 id="选择默认框的比例和长宽比-Choosing-scales-and-aspect-ratios-for-default-boxes"><a href="#选择默认框的比例和长宽比-Choosing-scales-and-aspect-ratios-for-default-boxes" class="headerlink" title="选择默认框的比例和长宽比 (Choosing scales and aspect ratios for default boxes)"></a>选择默认框的比例和长宽比 (Choosing scales and aspect ratios for default boxes)</h2><p>选取的特征图是：Conv4_3，Conv7，Conv8_2，Conv9_2，Conv10_2，Conv11_2</p>
<p>每层特征图的默认框比例计算：</p>
<script type="math/tex; mode=display">
s_{k}=s_{\min }+\frac{s_{\max }-s_{\min }}{m-1}(k-1), \quad k \in[1, m]</script><blockquote>
<ul>
<li>m:选取做预测的特征图数量。</li>
<li>k:第几个特征图。</li>
<li>$s_{\min }$:最小比例。（0.2）</li>
<li>$s_{\max }$:最大比例。（0.9）</li>
</ul>
</blockquote>
<p>选用的长宽比：</p>
<script type="math/tex; mode=display">
a_{r} \in\left\{1,2,3, \frac{1}{2}, \frac{1}{3}, s_{k}^{\prime}=\sqrt{s_{k} s_{k+1}} \right\}</script><blockquote>
<p>其中Conv4_3，Conv10_2，Conv11_2层仅使用4个默认框，不使用长宽比为3,1/3的默认框。</p>
<p>SSD总计预测：38 x 38 x 4 + 19 x 19 x 6 + 10 x 10 x 6 + 5 x 5 x 6 + 3 x 3 x 4 + 1 x 1 x 4 = 8732 个边界框。</p>
</blockquote>
<p>计算长和宽：</p>
<script type="math/tex; mode=display">
w_{k}^{a}=s_{k} \sqrt{a_{r}}, \quad h_{k}^{a}=s_{k} / \sqrt{a_{r}}</script><p>设置默认框中心为：</p>
<script type="math/tex; mode=display">
\left(\frac{i+0.5}{\left|f_{k}\right|}, \frac{j+0.5}{\left|f_{k}\right|}\right)</script><blockquote>
<ul>
<li>$|f_{k}|$: 第k个特征图的单元数量。</li>
<li>i,j: $i, j \in[0,\left|f_{k}\right|)$。</li>
</ul>
</blockquote>
<h2 id="严重的负样本处理-Hard-negative-mining"><a href="#严重的负样本处理-Hard-negative-mining" class="headerlink" title="严重的负样本处理 (Hard negative mining)"></a>严重的负样本处理 (Hard negative mining)</h2><p>因为在一张图像中，往往只有几个目标对象，所以大部分都是背景，被当作负样本，这将会导致严重的样本不平衡。</p>
<p>为了平衡样本，将所有的样本以分类的置信度排序，选取分数高的框，使负正样本比例为3:1。</p>
<h2 id="数据增强-Data-augmentation"><a href="#数据增强-Data-augmentation" class="headerlink" title="数据增强 (Data augmentation)"></a>数据增强 (Data augmentation)</h2><ul>
<li>使用原图。</li>
<li>裁减。</li>
<li>缩放。</li>
<li>水平翻转。</li>
</ul>
<h1 id="more"><a href="#more" class="headerlink" title="more"></a>more</h1><h2 id="note"><a href="#note" class="headerlink" title="note"></a>note</h2><p>本文主要与yolo比较，创新点主要在使用卷积中的多层特征图做定位和分类，采用卷积做分类。</p>
<h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/31427288" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/31427288</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/33544892" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/33544892</a></li>
<li><a href="https://www.zhihu.com/question/58200555" target="_blank" rel="noopener">https://www.zhihu.com/question/58200555</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/18/web/spring/spring-%E5%AD%A6%E4%B9%A05-MVC%E6%9B%B4%E5%A4%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dejiang">
      <meta itemprop="description" content="你根本不知道你什么都不知道">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫の故事">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/18/web/spring/spring-%E5%AD%A6%E4%B9%A05-MVC%E6%9B%B4%E5%A4%9A/" class="post-title-link" itemprop="url">[spring 学习5] MVC更多</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-18 16:34:04" itemprop="dateCreated datePublished" datetime="2019-12-18T16:34:04+08:00">2019-12-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-26 14:34:40" itemprop="dateModified" datetime="2019-12-26T14:34:40+08:00">2019-12-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/spring/" itemprop="url" rel="index">
                    <span itemprop="name">spring</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="multipart"><a href="#multipart" class="headerlink" title="multipart"></a>multipart</h1><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── build.gradle</span><br><span class="line">└── src</span><br><span class="line">    └── main</span><br><span class="line">        ├── java</span><br><span class="line">        │   └── com</span><br><span class="line">        │       └── yww</span><br><span class="line">        │           └── UploadsController.java</span><br><span class="line">        ├── resources</span><br><span class="line">        │   └── application.properties</span><br><span class="line">        └── webapp</span><br><span class="line">            ├── index.jsp</span><br><span class="line">            └── WEB-INF</span><br><span class="line">                ├── applicationContext.xml</span><br><span class="line">                ├── dispatcher-servlet.xml</span><br><span class="line">                ├── jsp</span><br><span class="line">                │   └── uploads.jsp</span><br><span class="line">                └── web.xml</span><br></pre></td></tr></table></figure>
<p>最简的设置只需要<code>web.xml</code>中配置，和<code>UploadsController.java</code>使用<code>@RequestPart</code>即可。</p>
<h2 id="multipart解析器"><a href="#multipart解析器" class="headerlink" title="multipart解析器"></a>multipart解析器</h2><p><code>DispatcherServlet</code>并没有实现任何解析multipart请求数据的功能。它将该任务委托给了Spring中<code>MultipartResolver</code>接口实现，通过该实现类解析multipart请求中的内容。</p>
<p>PS: <code>Part</code>方式不需要配置<code>MultipartResolver</code>。</p>
<p>Spring内置2个<code>MultipartResolver</code>实现：</p>
<ul>
<li><del><code>CommonsMultipartResolver</code>：使用Jakarta Commons FileUpload解析multipart请求。（不建议使用）</del></li>
<li><code>StandardServletMultipartResolver</code>：依赖于Servlet 3.0对multipart请求的支持。（需Spring 3.1以上版本）</li>
</ul>
<h2 id="配置multipart解析器"><a href="#配置multipart解析器" class="headerlink" title="配置multipart解析器"></a>配置multipart解析器</h2><p>最简单的配置，只需声明为Bean即可。（使用<code>Part</code>可省）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> MultipartResolver <span class="title">multipartResolver</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> StandardServletMultipartResolver();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更多的设置。我们需要在<code>Servlet</code>中配置，使用<code>web.xml</code>配置比较直观简便。指定了上传位置，文件大小，请求大小。</p>
<p>[<code>web.xml</code>]<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"4.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">multipart-config</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">location</span>&gt;</span>/tmp/uploads<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max-file-size</span>&gt;</span>2048000<span class="tag">&lt;/<span class="name">max-file-size</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">max-request-size</span>&gt;</span>4096000<span class="tag">&lt;/<span class="name">max-request-size</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">multipart-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        &lt;url-pattern&gt;*.form&lt;/url-pattern&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>使用java配置，在实现<code>WebApplicationInitializer</code>类的<code>onStartup()</code>方法中，或继承<code>AbstractAnnotationConfigDispatcherServletInitializer</code>类的<code>customizeRegistration</code>方法中设置<code>registration.setMultipartConfig()</code>配置。</p>
</blockquote>
<h2 id="处理multipart请求"><a href="#处理multipart请求" class="headerlink" title="处理multipart请求"></a>处理multipart请求</h2><h3 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h3><p>设置<code>enctype</code>为`multipart/form-data’，这会告诉浏览器以multipart数据的形式提交表单。</p>
<p>[<code>WEB-INF/jsp/uploads.jsp</code>]<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;uploads&lt;/h1&gt;</span><br><span class="line">    &lt;form method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span> &gt;</span><br><span class="line">        &lt;input type=<span class="string">"file"</span> name=<span class="string">"img"</span> /&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h3><p><code>@RequestPart</code>指定请求中对应part数据。如果提交表单时没有选择文件，那么这个数组会是空，而不是null。</p>
<p>[<code>UploadsController.java</code>]<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yww;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.Errors;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestPart;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Part;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadsController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/uploads"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">uploads</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"uploads"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/uploads"</span>, method = RequestMethod.POST)</span><br><span class="line"><span class="comment">//    public String processImage(@RequestPart("img") byte[] img) &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">processImage</span><span class="params">(@RequestPart(<span class="string">"img"</span>)</span> Part img) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            img.write(<span class="string">"/tmp/"</span> + img.getSubmittedFileName());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"uploads"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>web.xml</code>和<code>UploadsController.java</code>中都设置了写入的路径，但最后是以控制器中的为准。</p>
</blockquote>
<p>使用上传文件的原始<code>byte[]</code>比较简单但功能有限。因此，Spring还提供了2种接口处理：<code>Part</code>,<code>MultipartFile</code>，二者方法十分相似。</p>
<h2 id="html页面"><a href="#html页面" class="headerlink" title="html页面"></a>html页面</h2><p>[<code>uploads.jsp</code>]<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;uploads&lt;/h1&gt;</span><br><span class="line">    &lt;form method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span> &gt;</span><br><span class="line">        &lt;input type=<span class="string">"file"</span> name=<span class="string">"img"</span> /&gt;</span><br><span class="line">        &lt;input type=<span class="string">"submit"</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h1><p>不管是否正常运行，Servlet请求的输出都是一个Servlet响应。如果在请求处理的时候出现了异常，那它的输出依然会是Servlet响应。异常必须要以某种方式转换为响应。</p>
<p>Spring提供了多种方式将异常转换为响应：</p>
<ul>
<li>特定的Spring异常会自动映射为指定的HTTP状态码。</li>
<li>异常上可以添加@ResponseStatus注解，从而将其映射为某一个HTTP状态码。</li>
<li>在方法上可以添加@ExceptionHandle注解，使其用来处理异常。</li>
</ul>
<h2 id="项目结构-1"><a href="#项目结构-1" class="headerlink" title="项目结构"></a>项目结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── build.gradle</span><br><span class="line">└── src</span><br><span class="line">    └── main</span><br><span class="line">        ├── java</span><br><span class="line">        │   └── com</span><br><span class="line">        │       └── yww</span><br><span class="line">        │           ├── UserController.java</span><br><span class="line">        │           ├── User.java</span><br><span class="line">        │           ├── UserNotFoundException.java</span><br><span class="line">        │           └── UserNotFoundHandler.java</span><br><span class="line">        ├── resources</span><br><span class="line">        │   └── application.properties</span><br><span class="line">        └── webapp</span><br><span class="line">            ├── index.jsp</span><br><span class="line">            └── WEB-INF</span><br><span class="line">                ├── applicationContext.xml</span><br><span class="line">                ├── dispatcher-servlet.xml</span><br><span class="line">                ├── jsp</span><br><span class="line">                │   └── error</span><br><span class="line">                │       └── usernotfound.jsp</span><br><span class="line">                └── web.xml</span><br></pre></td></tr></table></figure>
<h2 id="异常映射HTTP状态码"><a href="#异常映射HTTP状态码" class="headerlink" title="异常映射HTTP状态码"></a>异常映射HTTP状态码</h2><div class="table-container">
<table>
<thead>
<tr>
<th>Spring异常</th>
<th>HTTP状态码</th>
</tr>
</thead>
<tbody>
<tr>
<td>BindException</td>
<td>400 - Bad Request</td>
</tr>
<tr>
<td>ConversionNotSupportedException</td>
<td>500 - Internal Server Error</td>
</tr>
<tr>
<td>HttpMediaTypeNotAcceptableException</td>
<td>406 - Not Acceptable</td>
</tr>
<tr>
<td>HttpMediaTypeNotSupportedException</td>
<td>415 - Unsupported Media Type</td>
</tr>
<tr>
<td>HttpMessageNotReadableException</td>
<td>400 - Bad Request</td>
</tr>
<tr>
<td>HttpMessageNotWritableException</td>
<td>500 - Internal Server Error</td>
</tr>
<tr>
<td>HttpRequestMethodNotSupportedException</td>
<td>405 - Method Not Allowed</td>
</tr>
<tr>
<td>MethodArgumentNotValidException</td>
<td>400 - Bad Request</td>
</tr>
<tr>
<td>MissingServletRequestParameterException</td>
<td>400 - Bad Request</td>
</tr>
<tr>
<td>MissingServletRequestPartException</td>
<td>400 - Bad Request</td>
</tr>
<tr>
<td>TypeMismatchException</td>
<td>400 - Bad Request</td>
</tr>
</tbody>
</table>
</div>
<p>以上异常，一般会由Spring自身抛出。</p>
<p>如果需要自定义异常，并将其映射到HTTP状态码上，只需要使用<code>@ResponseStatus</code>注解自定义的异常类即可。使用时，在需要的地方抛出即可。</p>
<p>[<code>UserNotFoundException.java</code>]<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yww;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ResponseStatus</span>(value = HttpStatus.NOT_FOUND, reason=<span class="string">"User Not Found"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserNotFoundException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在引入<code>@ResponseStatus</code>注解之后，如果控制器方法抛出这个异常的话，响应将会具有<code>404状态码</code>。</p>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>为了处理异常情况，可以在控制器里添加一个带<code>@ExceptionHandler</code>注解的方法，当指定异常抛出时，它会处理。</p>
<p>[<code>UserController.java</code>]<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yww;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.ModelMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">printHome</span><span class="params">(ModelMap model)</span></span>&#123;</span><br><span class="line"><span class="comment">//        String username = "yww";</span></span><br><span class="line">        String username = <span class="string">"yww_no"</span>;</span><br><span class="line">        <span class="keyword">if</span>(username == <span class="string">"yww"</span>)&#123;</span><br><span class="line">            System.out.println(username);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UserNotFoundException();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"home"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(UserNotFoundException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">handleUserNotFound</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"error/usernotfound"</span>;    <span class="comment">// 视图</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>PS:这有一个问题，如果每个控制器都需要使用这个异常处理，则需要每个控制器都写上这个<code>@ExceptionHandler</code>的方法，或者继承一个父类。Spring提供了一个更好的解决方式，<code>控制器通知</code>用于处理所有控制器中的<code>异常</code>,<code>初始化</code>,<code>模型属性</code>。（如下）</p>
<h1 id="控制器通知"><a href="#控制器通知" class="headerlink" title="控制器通知"></a>控制器通知</h1><p>控制器通知（controller advice）是任意带有<code>@ControllerAdvice</code>注解的类，这个类会包含一个或多个如下类型的方法：</p>
<ul>
<li><code>@ExceptionHandler</code>标注的方法。</li>
<li><code>@InitBinder</code>标注的方法。</li>
<li><code>@ModelAttribute</code>标注的方法。</li>
</ul>
<blockquote>
<p>由此可见，控制器通知不仅可以作为异常的集中处理，还有其它2种功能使用。</p>
</blockquote>
<p>在带有<code>@ControllerAdvice</code>注解的类中，以上所述的方法会运用到整个应用程序所有控制器带有<code>@RequestMapping</code>注解的方法上。</p>
<blockquote>
<p><code>@ControllerAdvice</code>本身已经使用了<code>@Component</code>。</p>
</blockquote>
<p>[<code>UserNotFoundHandler.java</code>]<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yww;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserNotFoundHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(UserNotFoundException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">handleUserNotFound</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"error/usernotfound"</span>;    <span class="comment">// 视图</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="跨重定向请求传递数据"><a href="#跨重定向请求传递数据" class="headerlink" title="跨重定向请求传递数据"></a>跨重定向请求传递数据</h1><p>在处理完POST请求后，最佳实践是执行一下重定向。（避免用户点击刷新或返回，导致客户端重新执行危险的POST请求。）</p>
<p>一般来说，当一个处理器方法完成后，该方法所指定的模型数据将会复制到请求中，作为请求中的属性，请求会转发（forward）到视图上进行渲染。因为控制器方法和视图所处理的是同一个请求，所以在转发过程中属性能够得以保存。</p>
<p>但是，当控制器的结果是重定向的话，原始的请求就结束了，并且会发起一个新的GET请求。原始请求中所带的模型数据也就消亡了。</p>
<p>于是，对于重定向来说，模型不能用来传递数据。可以使用其它方案：</p>
<ul>
<li>使用URL模板以路径变量或查询参数的形式传递数据。</li>
<li>通过flash属性发送数据。</li>
</ul>
<h2 id="url传递数据"><a href="#url传递数据" class="headerlink" title="url传递数据"></a>url传递数据</h2><p>最简单的就是用过拼接字符串。但当构建URL或SQL查询时，使用字符串连接很危险。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="string">"redirect:/user/"</span> + <span class="string">"username"</span>;</span><br></pre></td></tr></table></figure>
<p>使用占位符解决，<code>{username}</code>作为占位符填充到URL模板中，而模型中的<code>id</code>属性没有匹配到URL中的占位符，所以它会自动以查询参数的形式附加到重定向URL上。</p>
<p>[<code>UserRedirectUrlController.java</code>]<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yww;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRedirectUrlController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/user_re_url"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">        String username = <span class="string">"yww"</span>;</span><br><span class="line">        <span class="keyword">int</span> id = <span class="number">1001</span>;</span><br><span class="line">        model.addAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">        model.addAttribute(<span class="string">"id"</span>, id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/user/&#123;username&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="flash属性传递数据"><a href="#flash属性传递数据" class="headerlink" title="flash属性传递数据"></a>flash属性传递数据</h2><p>使用路径重定向传递数据，只能发送字符串和数字这样简单的数据，如果需要发送如对象的数据，需要使用<code>flash</code>。</p>
<p>这将会把数据放到会话中，再重定向后取出，我们再负责清除掉。Spring提供了通过<code>RedirectAttributes</code>设置<code>flash</code>属性的方法。它是<code>Model</code>的子接口。</p>
<p>[<code>UserRedirectFlashController.java</code>]<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yww;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.support.RedirectAttributes;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRedirectFlashController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/user_re_flash"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">postUser</span><span class="params">(RedirectAttributes model)</span></span>&#123;</span><br><span class="line">        String username = <span class="string">"yww"</span>;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.username = <span class="string">"yww"</span>;</span><br><span class="line">        user.id = <span class="number">1001</span>;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">        model.addFlashAttribute(<span class="string">"user"</span>, user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/user/&#123;username&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下一个请求的控制器如何取得flash的数据。</p>
<p>[<code>ShowUserController.java</code>]<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yww;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.mvc.support.RedirectAttributes;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRedirectFlashController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/user_re_flash"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">postUser</span><span class="params">(RedirectAttributes model)</span></span>&#123;</span><br><span class="line">        String username = <span class="string">"yww"</span>;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.username = <span class="string">"yww"</span>;</span><br><span class="line">        user.id = <span class="number">1001</span>;</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">"username"</span>, username);</span><br><span class="line">        model.addFlashAttribute(<span class="string">"user"</span>, user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/user/&#123;username&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/17/note/about-me-detail/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dejiang">
      <meta itemprop="description" content="你根本不知道你什么都不知道">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫の故事">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/17/note/about-me-detail/" class="post-title-link" itemprop="url">about me - detail</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-17 00:00:00" itemprop="dateCreated datePublished" datetime="2019-12-17T00:00:00+08:00">2019-12-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-26 14:34:40" itemprop="dateModified" datetime="2019-12-26T14:34:40+08:00">2019-12-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index">
                    <span itemprop="name">note</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="个人信息"><a href="#个人信息" class="headerlink" title="个人信息"></a>个人信息</h1><ul>
<li>姓名：dejiangsong</li>
<li>硕士：西南大学</li>
<li>本科：兰州理工大学</li>
<li>电话：136<em>**</em>211</li>
<li>邮件：1018472917@qq.com</li>
<li>Github：wwstory.github.io</li>
<li>Github(old)：github.com/dejiangsong</li>
</ul>
<h1 id="技能"><a href="#技能" class="headerlink" title="技能"></a>技能</h1><script src="https://cdn.bootcss.com/echarts/4.3.0/echarts.min.js"></script>
<div id="chart" style="width:100%; height:700px;">
</div>
<script type="text/javascript">
    var myChart = echarts.init(document.getElementById('chart'));
    var option = {
    title: [{
        text: '语言',
        x: '10%',
        textAlign: 'center'
    },
    {
        text: '算法',
        x: '35%',
        textAlign: 'center'
    },
    {
        text: '基础',
        x: '60%',
        textAlign: 'center'
    },
    {
        text: '底层',
        x: '85%',
        textAlign: 'center'
    },
    {
        text: '机器学习',
        x: '10%',
        y: '50%',
        textAlign: 'center'
    },
    {
        text: '深度学习',
        x: '35%',
        y: '50%',
        textAlign: 'center'
    },
    {
        text: 'web开发',
        x: '60%',
        y: '50%',
        textAlign: 'center'
    },
    {
        text: 'other',
        x: '85%',
        y: '50%',
        textAlign: 'center'
    },],
    tooltip: {
        trigger: 'axis'
    },
    legend: {
        x: 'center',
        data: [
            '语言', 
            '算法', 
            '基础', 
            '底层', 
            '机器学习', '线性模型', '神经网络', '决策树', '支持向量机', '聚类', '贝叶斯分类器', '概率图模型', '特征选择与稀疏学习', '降维与度量学习', '集成学习', '半监督学习', '强化学习',
            '深度学习', 'CNN', 'RNN', 'GAN', 'optim', 'object detection', 'driverless', 'face',
            'web开发', 'jvm', '设计模式', 'spring', 'mysql', 'mybatis', 'redis', 'mongodb', 'mq', 'docker', '微服务', 'nginx', 'vue',
            'other', 'arduino', '51', 'STM32', 'nvidia xavier', '机械', 'ros', 'qt', 'flask',
            ]
    },
    // 0：基本不知, 1：入门, 2：进阶, 3：应用, 4：熟练, 5：掌握
    radar: [
        {
            indicator: [
                { text: 'python', max: 5 },
                { text: 'java', max: 5 },
                { text: 'c/c++', max: 5 },
                { text: 'go', max: 5 },
                { text: 'c#', max: 5 },
            ],
            center: ['10%', '30%'],
            radius: 50,
            title: {
                text: 'abc'
            }
        },
        {
            indicator: [
                { text: '数学', max: 5 },
                { text: '表', max: 5 },
                { text: '树', max: 5 },
                { text: '图', max: 5 },
                { text: '分冶', max: 5 },
                { text: '回溯', max: 5 },
                { text: '动态规划', max: 5 },
                { text: '贪心', max: 5 },
            ],
            center: ['35%', '30%'],
            radius: 50,
        },
        {
            indicator: [
                { text: '数据结构', max: 5 },
                { text: '计算机组成原理', max: 5 },
                { text: '操作系统', max: 5 },
                { text: '计算机网络', max: 5 },
                { text: 'linux', max: 5 },
                { text: '微机原理', max: 5 },
                { text: '编译原理', max: 5 },
            ],
            center: ['60%', '30%'],
            radius: 50
        },
        {
            indicator: [
                { text: 'c/c++库', max: 5 },
                { text: '编译器', max: 5 },
                { text: 'linux内核', max: 5 },
                { text: '机器学习库', max: 5 },
                { text: '深度学习库', max: 5 },
                { text: 'jvm', max: 5 },
                { text: 'python vm', max: 5 },
            ],
            center: ['85%', '30%'],
            radius: 50
        },
        {
            indicator: [
                { text: '广度', max: 5 },
                { text: '深度', max: 5 },
                { text: '理解', max: 5 },
                { text: '原理', max: 5 },
                { text: '代码', max: 5 },
                { text: '应用', max: 5 },
            ],
            center: ['10%', '80%'],
            radius: 50
        },
        {
            indicator: [
                { text: '广度', max: 5 },
                { text: '深度', max: 5 },
                { text: '理解', max: 5 },
                { text: '原理', max: 5 },
                { text: '代码', max: 5 },
                { text: '应用', max: 5 },
            ],
            center: ['35%', '80%'],
            radius: 50
        },
        {
            indicator: [
                { text: '广度', max: 5 },
                { text: '深度', max: 5 },
                { text: '理解', max: 5 },
                { text: '原理', max: 5 },
                { text: '代码', max: 5 },
                { text: '应用', max: 5 },
            ],
            center: ['60%', '80%'],
            radius: 50
        },
        {
            indicator: [
                { text: '广度', max: 5 },
                { text: '深度', max: 5 },
                { text: '理解', max: 5 },
                { text: '原理', max: 5 },
                { text: '代码', max: 5 },
                { text: '应用', max: 5 },
            ],
            center: ['85%', '80%'],
            radius: 50
        },
    ],
    series: [
        {
            type: 'radar',
            tooltip: {
                trigger: 'item'
            },
            itemStyle: { normal: { areaStyle: { type: 'default' } } },
            data: [
                {
                    name: '语言',
                    value: [4, 3, 2, 1, 2]
                }
            ]
        },
        {
            type: 'radar',
            radarIndex: 1,
            tooltip: {
                trigger: 'item'
            },
            itemStyle: { normal: { areaStyle: { type: 'default' } } },
            data: [
                {
                    name: '算法',
                    value: [0, 3, 2, 2, 2, 2, 2, 1]
                }
            ]
        },
        {
            type: 'radar',
            radarIndex: 2,
            tooltip: {
                trigger: 'item'
            },
            itemStyle: { normal: { areaStyle: { type: 'default' } } },
            data: [
                {
                    name: '基础',
                    value: [4, 0, 0, 0, 4, 3, 0]
                }
            ]
        },
        {
            type: 'radar',
            radarIndex: 3,
            tooltip: {
                trigger: 'item'
            },
            itemStyle: { normal: { areaStyle: { type: 'default' } } },
            data: [
                {
                    name: '底层',
                    value: [0, 0, 1, 2, 4, 2, 0],
                }
            ]
        },
        {
            type: 'radar',
            radarIndex: 4,
            tooltip: {
                trigger: 'item'
            },
            data: [
                {
                    name: '线性模型',
                    value: [4, 4, 4, 4, 4, 5],
                },
                {
                    name: '神经网络',
                    value: [4, 4, 4, 4, 4, 5],
                },
                {
                    name: '决策树',
                    value: [3, 3, 4, 3, 0, 0],
                },
                {
                    name: '支持向量机',
                    value: [3, 2, 2, 0, 0, 0],
                },
                {
                    name: '聚类',
                    value: [3, 2, 2, 1, 0, 0],
                },
                {
                    name: '贝叶斯分类器',
                    value: [2, 2, 2, 1, 0, 0],
                },
                {
                    name: '概率图模型',
                    value: [2, 1, 1, 0, 0, 0],
                },
                {
                    name: '特征选择与稀疏学习',
                    value: [3, 2, 2, 2, 1, 0],
                },
                {
                    name: '降维与度量学习',
                    value: [3, 2, 2, 1, 0, 0],
                },
                {
                    name: '集成学习',
                    value: [3, 2, 2, 2, 0, 0],
                },
                {
                    name: '半监督学习',
                    value: [3, 2, 2, 1, 0, 0],
                },
                {
                    name: '强化学习',
                    value: [3, 2, 2, 1, 0, 0],
                },
            ]
        },
        {
            type: 'radar',
            radarIndex: 5,
            tooltip: {
                trigger: 'item'
            },
            data: [
                {
                    name: 'CNN',
                    value: [4, 3, 3, 3, 4, 4],
                },
                {
                    name: 'RNN',
                    value: [2, 2, 3, 1, 0, 1],
                },
                {
                    name: 'GAN',
                    value: [4, 3, 3, 3, 0, 2],
                },
                {
                    name: 'optim优化',
                    value: [3, 2, 2, 2, 2, 2],
                },
                {
                    name: 'object detection',
                    value: [2, 2, 2, 2, 0, 0],
                },
                {
                    name: 'driverless',
                    value: [2, 1, 1, 0, 0, 0],
                },
                {
                    name: 'face',
                    value: [3, 2, 3, 2, 3, 2],
                },
            ]
        },
        {
            type: 'radar',
            radarIndex: 6,
            tooltip: {
                trigger: 'item'
            },
            data: [
                {
                    name: 'jvm',
                    value: [2, 1, 1, 1, 0, 0],
                },
                {
                    name: '设计模式',
                    value: [2, 1, 1, 1, 0, 0],
                },
                {
                    name: 'spring',
                    value: [3, 3, 3, 2, 1, 1],
                },
                {
                    name: 'mysql',
                    value: [3, 2, 2, 1, 3, 3],
                },
                {
                    name: 'mybatis',
                    value: [2, 1, 2, 1, 0, 0],
                },
                {
                    name: 'redis',
                    value: [3, 3, 3, 2, 2, 0],
                },
                {
                    name: 'mongodb',
                    value: [1, 1, 1, 1, 1, 0],
                },
                {
                    name: 'mq',
                    value: [2, 1, 1, 1, 1, 0],
                },
                {
                    name: 'docker',
                    value: [1, 1, 1, 0, 0, 0],
                },
                {
                    name: '微服务',
                    value: [0, 0, 0, 0, 0, 0],
                },
                {
                    name: 'nginx',
                    value: [0, 0, 0, 0, 0, 0],
                },
                {
                    name: 'vue',
                    value: [2, 1, 2, 1, 1, 1],
                },
            ]
        },
        {
            type: 'radar',
            radarIndex: 7,
            tooltip: {
                trigger: 'item'
            },
            data: [
                {
                    name: 'arduino',
                    value: [5, 5, 4, 4, 5, 5],
                },
                {
                    name: '51',
                    value: [4, 3, 4, 3, 3, 3],
                },
                {
                    name: 'STM32',
                    value: [2, 1, 1, 1, 1, 1],
                },
                {
                    name: 'nvidia xavier',
                    value: [2, 2, 2, 0, 1, 1],
                },
                {
                    name: '机械',
                    value: [3, 2, 2, 2, 0, 1],
                },
                {
                    name: 'ros',
                    value: [2, 2, 1, 1, 1, 1],
                },
                {
                    name: 'qt',
                    value: [2, 2, 2, 1, 1, 1],
                },
                {
                    name: 'flask',
                    value: [2, 2, 2, 1, 2, 1],
                },
            ]
        },
    ]
};
    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
</script>


<h1 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h1><p>本科专业为机械自动化：对编程十分感兴趣，在协会做了2年单片机和电路开发，制作了一些机器人参加过”互联网+”，”挑战杯”等比赛，获得过国奖，省奖等。零零散散的学过c，c#，java，python，android，html，css，js，mysql，unity等，用C#做过WinForm和asp.net程序。自我感觉：虽然之前做过的很多东西，现在看过于初级，但锻炼了不少代码能力。</p>
<p>硕士到了计算机专业：花了一段时间补齐了计算机的核心知识，数据结构和计算机网络等。系统学习了java体系，熟练使用了python，平时刷刷算法题，会使用pytorch和tensorflow。研究方向是做无人驾驶，学了1年多的机器学习和深度学习，看过几本相关书籍，看了十几篇论文，理解并掌握了论文的代码逻辑，复现过几篇代码。期间帮博士师兄改了1年多论文代码的bug，学了一些人脸，文本图像跨模态检索，ORC等知识。自我感觉：知识有了一定的体系，码代码是真的熟练，对论文有理解能力。</p>
<p><a href="../../../2019/08/01/note/book-list-readed">书单(已读)</a><br><a href="../../../2019/08/01/note/book-list">书单</a><br><a href="../../../2018/07/01/note/book-list-readed-old">旧书单(已读)</a></p>
<h1 id="项目经验"><a href="#项目经验" class="headerlink" title="项目经验"></a>项目经验</h1><p><strong>本科阶段</strong></p>
<ul>
<li>2015.11.1 - 2015.12.15 ： 使用RFID管理数控机床刀具。使用C#开发的WinForm程序。</li>
<li>2016.5.1 - 2017.7.1 ： 做过几个嵌入式程序开发。使用c语言控制，采取传感器输入，控制机械部件，用于参加比赛。</li>
<li>2017.6.1 - 2017.8.1 ： android端控制机器人的app。获取图像，使用wifi转zigbee发送控制信号，用于参加比赛。</li>
<li>2016.10.1 - 2017.12.1 ： 基于RFID刀具在线管理系统。使用C#开发的asp.net网站，用于答辩大学生创新训练项目。</li>
</ul>
<p><strong>硕士阶段</strong></p>
<ul>
<li>2019.5.28 - 2019.9.1 ： 连接稳定性探索。美的iot部门对智能设备掉线问题，使用数据分析掉线因素，采用机器学习或深度学习的方法，预估离线原因和离线时长，尝试修复问题，或给予用户反馈。</li>
<li>2019.7.1 - 2018.7.18 ： 会议人脸识别门禁。对参会人员识别，并提供座位号等相关信息，dlib+qt实现。</li>
<li>2019.9.1 - ： 无人驾驶小车。从零搭建一个可用的无人驾驶的小车。</li>
</ul>
<h1 id="经验"><a href="#经验" class="headerlink" title="经验"></a>经验</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/15/web/spring/spring-DispatcherServlet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dejiang">
      <meta itemprop="description" content="你根本不知道你什么都不知道">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫の故事">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/15/web/spring/spring-DispatcherServlet/" class="post-title-link" itemprop="url">[spring] DispatcherServlet</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-15 19:13:00" itemprop="dateCreated datePublished" datetime="2019-12-15T19:13:00+08:00">2019-12-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-26 14:34:40" itemprop="dateModified" datetime="2019-12-26T14:34:40+08:00">2019-12-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/spring/" itemprop="url" rel="index">
                    <span itemprop="name">spring</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="请求过程"><a href="#请求过程" class="headerlink" title="请求过程"></a>请求过程</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">                            ┌─────────┐</span><br><span class="line">                           ↗│ 处理器映射│</span><br><span class="line">                         2&#x2F; └─────────┘</span><br><span class="line">                         &#x2F;         3</span><br><span class="line">请求 1 ┌─────────────────┐ --------------------&gt; ┌─────┐</span><br><span class="line">-----&gt;│DispatcherServlet│ &lt;--┌─────────────┐  4 │控制器│</span><br><span class="line">      └─────────────────┘    │模型及逻辑视图名│ ---│     │</span><br><span class="line">                      \  \   └─────────────┘    └─────┘</span><br><span class="line">                       \  \5   ┌────────┐</span><br><span class="line">                       6\  ---&gt;│视图解析器│</span><br><span class="line">                         ↘     └────────┘</span><br><span class="line">            响应 7      ┌────┐</span><br><span class="line">&lt;----------------------│视图 │</span><br><span class="line">                       └────┘</span><br></pre></td></tr></table></figure>
<p>过程：</p>
<ul>
<li>请求：请求离开浏览器时，会带有用户所请求内容的信息，至少会包含请求的URL。（还可能带有如表单信息）</li>
<li>DispatcherServlet：将请求发送给Spring MVC控制器（controller）</li>
</ul>
<blockquote>
<ul>
<li><code>DispatcherServlet</code>：与大多数基于Java的Web框架一样，Spring MVC所有的请求都会通过一个前端控制器（front controller）Servlet。在这里一个单例的Servlet将请求委托给应用程序的其他组件来执行实际的处理。在Spring MVC中，DispatcherServlet就是前端控制器。</li>
<li><code>DispatcherServlet</code>的任务是将请求发送给Spring MVC控制器（<code>controller</code>）。（控制器是一个用于处理请求的Spring组件。）</li>
<li><code>DispatcherServlet</code>需要知道应该将请求发送给哪个控制器。所以<code>DispatcherServlet</code>以会查询一个或多个<code>处理器映射（handler mapping</code>）来确定请求的下一站在哪里。处理器映射会根据请求所携带的URL信息来进行决策。</li>
<li>到了控制器，请求会卸下负载（用户提交的信息）并耐心等待控制器处理这些信息。（实际上，设计良好的控制器本身只处理很少甚至不处理工作，而是将业务逻辑委托给一个或多个服务对象进行处理）</li>
<li>控制器在完成逻辑处理后，通常会产生一些信息，这些信息需要返回给用户并在浏览器上显示。这些信息被称为模型（<code>model</code>）。</li>
<li><p>这些信息通常需要以用户友好的方式进行格式化，一般会是HTML。所以信息需要发送给一个视图（<code>view</code>），通常会是JSP。</p>
</li>
<li><p>控制器所做的最后一件事就是将模型数据打包，并且标识出用于渲染输出的视图名。它接下来会将请求连同<code>模型</code>和<code>视图名</code>发送回<code>DispatcherServlet</code>。</p>
</li>
<li>传递给<code>DispatcherServlet</code>的视图名并不直接表示某个特定的JSP。实际上它甚至不能确定视图就是JSP。相反，它仅仅传递了一个<code>逻辑名称</code>，这个名字将会用来查找产生结果的真正视图。</li>
<li><code>DispatcherServlet</code>将会使用<code>视图解析器（view resolver）</code>来将逻辑视图名匹配为一个特定的视图实现，它可能是也可能不是JSP。</li>
<li>视图将会使用模型数据渲染输出，这个输出会通过响应对象传递给客户端。</li>
</ul>
</blockquote>
<h1 id="配置DispatcherServlet"><a href="#配置DispatcherServlet" class="headerlink" title="配置DispatcherServlet"></a>配置DispatcherServlet</h1><p><code>DispatcherServlet</code>可以配置到<code>web.xml</code>文件中。</p>
<h2 id="AbstractAnnotationConfigDispatcherServletInitializer"><a href="#AbstractAnnotationConfigDispatcherServletInitializer" class="headerlink" title="AbstractAnnotationConfigDispatcherServletInitializer"></a>AbstractAnnotationConfigDispatcherServletInitializer</h2><p>在Servlet 3规范和Spring 3.1中，可以使用java将<code>DispatcherServlet</code>配置在<code>Servlet容器</code>中，需要继承<code>AbstractAnnotationConfigDispatcherServletInitializer</code>，重写3个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yww.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebAppInitializer</span> <span class="keyword">extends</span> <span class="title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Class[]&#123; RootConifg<span class="class">.<span class="keyword">class</span> &#125;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;    <span class="comment">// 指定配置类</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Class[]&#123; WebConfig<span class="class">.<span class="keyword">class</span> &#125;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;   <span class="comment">// 将DispatcherServlet映射到"/"</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123; <span class="string">"/"</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>getServletMappings()</code>：会将一个或多个路径映射到<code>DispatcherServlet</code>上。本例中，它映射的是”<code>/</code>“，这表示它会是应用的默认Servlet。它会处理进入应用的所有请求。</li>
<li>要理解另2个方法，首先要理解<code>DispatcherServlet</code>和<code>Servlet监听器（ContextLoaderListener）</code>的关系。（如下）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    AbstractAnnotationConfigDispatcherServletInitializer</span><br><span class="line">              |                            |</span><br><span class="line">             创建                          创建</span><br><span class="line">              |                            |</span><br><span class="line">              v                            v</span><br><span class="line">      DispatcherServlet               ContextLoaderListener</span><br><span class="line">              |                            |</span><br><span class="line">             加载                          加载</span><br><span class="line">              |                            |</span><br><span class="line">              v                            V</span><br><span class="line">          应用上下文                     应用上下文</span><br><span class="line">（查找@Configuration注解的类，      （查找@Configuration注解的类，</span><br><span class="line">  加载包含Web组件的bean。             加载应用中的其它bean。</span><br><span class="line">  如控制器,视图解析器,处理器映射等）     如自定义的业务所需的bean）</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong><code>AbstractAnnotationConfigDispatcherServletInitializer</code>剖析</strong>：</p>
<ul>
<li>在Servlet 3.0环境中，容器会在类路径中查找实现<code>javax.servlet.ServletContainerInitializer</code>接口的类，如果能发现的话，就会用它来配置Servlet容器。</li>
<li>Spring提供了这个接口的实现，名为<code>SpringServletContainerInitializer</code>，这个类反过来又会查找实现<code>WebApplicationInitializer</code>的类并将配置的任务交给它们来完成。</li>
<li>Spring 3.2引入了一个便利的<code>WebApplicationInitializer</code>基础实现，也就是<code>AbstractAnnotationConfigDispatcherServletInitializer</code>。</li>
<li>当我们自定义的类继承了<code>AbstractAnnotationConfigDispatcherServletInitializer</code>，当部署到<code>Servlet 3.0容器</code>中的时候，容器会自动发现它，并用来配置<code>Servlet上下文</code>。</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">                    容器(Servlet 3.0)</span><br><span class="line">                            |类路径查找</span><br><span class="line">                            v</span><br><span class="line">        实现javax.servlet.ServletContainerInitializer接口的类</span><br><span class="line">                            |</span><br><span class="line">                            v</span><br><span class="line">          SpringServletContainerInitializer（Spring提供）</span><br><span class="line">                            |查找</span><br><span class="line">                            v</span><br><span class="line">    实现&#96;WebApplicationInitializer&#96;的类，将配置的任务交给它们完成</span><br><span class="line">                            |</span><br><span class="line">            AbstractDispatcherServletInitializer</span><br><span class="line">              AbstractContextLoaderInitializer</span><br><span class="line">                            |</span><br><span class="line">                            v</span><br><span class="line">AbstractAnnotationConfigDispatcherServletInitializer（Spring提供）</span><br><span class="line">                            |</span><br><span class="line">                            v</span><br><span class="line">              自定义类继承，即可配置Servlet上下文</span><br></pre></td></tr></table></figure>
<h2 id="Servlet配置类"><a href="#Servlet配置类" class="headerlink" title="Servlet配置类"></a>Servlet配置类</h2><p>作用：启用Web MVC，启用组件扫描，配置视图解析器，配置静态资源的处理。</p>
<p><code>WebConfig.java</code>在上面<code>getServletConfigClasses()</code>方法中设置。</p>
<p><strong>最简单的配置</strong>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yww.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>空配置的<code>WebConfig</code>尽管能启用Spring MVC，但有不少问题：</p>
<ul>
<li>没有配置视图解析器。Spring默认会使用<code>BeanNameVire-Resolver</code>，这个视图解析器会查找ID与视图名称匹配的bean，并且查找bean要实现View接口，它以这样的方式解析视图。</li>
<li>没有启用组件扫描。Spring只能找到显式声明在配置类中的控制器。</li>
<li><code>DispatcherServlet</code>会映射为应用的默认Servlet，所以它会处理所有请求，包括对静态资源的请求。</li>
</ul>
<p><strong>最小但可用的Spring MVC配置</strong>：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yww.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ViewResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.view.InternalResourceViewResolver;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span>       <span class="comment">// 启用Spring MVC</span></span><br><span class="line"><span class="meta">@ComponentScan</span>      <span class="comment">// 启用组件扫描</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置JSP视图解析器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ViewResolver <span class="title">viewResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        InternalResourceViewResolver resolver = <span class="keyword">new</span> InternalResourceViewResolver();</span><br><span class="line">        resolver.setPrefix(<span class="string">"/WEB-INF/jsp/"</span>);</span><br><span class="line">        resolver.setSuffix(<span class="string">".jsp"</span>);</span><br><span class="line">        resolver.setExposeContextBeansAsAttributes(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> resolver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置静态资源的处理</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span></span>&#123;</span><br><span class="line">        configurer.enable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>@ComponentScan</code>会找到带有<code>@Controller</code>注解的类，因此，我们不需要在配置类中显式声明控制器。</p>
<p><code>ViewResolver</code>会按照设定的前后缀查找JSP文件。</p>
<p><code>configureDefaultServletHandling()</code>方法通过调用<code>DefaultServletHandlerConfigurer</code>的<code>enable()</code>方法，要求<code>DispatcherServlet</code>将对静态资源的请求转发到<code>Servlet容器</code>中默认的Servlet上，而不是<code>DispatcherServlet</code>本身来处理此类要求。</p>
<h2 id="Root配置类"><a href="#Root配置类" class="headerlink" title="Root配置类"></a>Root配置类</h2><p>作用：加载自定义的业务组件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yww.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan.Filter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.FilterType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(</span><br><span class="line">        basePackages = &#123;<span class="string">"com.yww"</span>&#125;,</span><br><span class="line">        excludeFilters = &#123;<span class="meta">@Filter</span>(type= FilterType.ANNOTATION, value = EnableWebMvc<span class="class">.<span class="keyword">class</span>)&#125;</span></span><br><span class="line"><span class="class">)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">RootConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="web-xml中声明DispatcherServlet"><a href="#web-xml中声明DispatcherServlet" class="headerlink" title="web.xml中声明DispatcherServlet"></a>web.xml中声明DispatcherServlet</h1><blockquote>
<p>使用java配置的方式，<code>AbstractAnnotationConfigDispatcherServletInitializer</code>会自动注册<code>DispatcherServlet</code>和<code>ContextLoaderListener</code>。而使用web.xml配置，需要手动配置。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"4.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;url-pattern&gt;*.form&lt;/url-pattern&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>ContextLoaderListener</code>和<code>DispatcherServlet</code>前面提到过，它们各自会加载一个Spring应用上下文。</p>
<ul>
<li><p><strong><code>ContextLoaderListener</code></strong>：上下文参数<code>contextConfigLocation</code>指定了一个XML文件的地址，这个文件定义了根应用上下文，它会被<code>ContextLoaderListener</code>加载。根上下文会从<code>/WEB-INF/applicationContext.xml</code>中加载bean定义。</p>
</li>
<li><p><strong><code>DispatcherServlet</code></strong>：<code>DispatcherServlet</code>会根据Servlet的名字找到一个文件，并基于该文件加载应用上下文。这里Servlet的名字为<code>dispatcher</code>，因此<code>DispatcherServlet</code>会从<code>/WEB-INF/dispatcher-servlet.xml</code>文件中加载其应用上下文。（也可以使用<code>&lt;init-param&gt;</code>指定文件位置。如下）</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/spring/servlet-context.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="配置DispatcherServlet-更多"><a href="#配置DispatcherServlet-更多" class="headerlink" title="配置DispatcherServlet 更多"></a>配置DispatcherServlet 更多</h1><p>在<code>AbstractAnnotationConfigDispatcherServletInitializer</code>将<code>DispatcherServlet</code>注册到<code>Servlet容器</code>中之后，就会调用<code>customizeRegistration()</code>，并将Servlet注册后得到的<code>Registration.Dynamic</code>传递进来。通过重载<code>customizeRegistration()</code>方法，我们可以对<code>DispatcherServlet</code>进行额外的配置。</p>
<blockquote>
<p>可用于开启对<code>multipart请求</code>和<code>文件上传</code>等。</p>
</blockquote>
<h2 id="添加其它的Servlet和Filter"><a href="#添加其它的Servlet和Filter" class="headerlink" title="添加其它的Servlet和Filter"></a>添加其它的Servlet和Filter</h2><p><code>AbstractAnnotationConfigDispatcherServletInitializer</code>会创建<code>DispatcherServlet</code>和<code>ContextLoaderListener</code>。</p>
<p>如果自己想创建<code>Servlet</code>,<code>Filter</code>,<code>Listener</code>，（就是往<code>Web容器</code>中注册其它组件），只需要创建一个新的初始化器就可以了。最简单的方式就是实现Spring的<code>WebApplicationInitializer</code>接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyServletInitializer.java</span></span><br><span class="line"><span class="keyword">package</span> com.yww.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.WebApplicationInitializer;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServletInitializer</span> <span class="keyword">implements</span> <span class="title">WebApplicationInitializer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// 注册Servlet</span></span><br><span class="line">        javax.servlet.ServletRegistration.Dynamic myServlet = servletContext.addServlet(<span class="string">"myServlet"</span>, MyServlet<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        myServlet.addMapping(<span class="string">"/custom/**"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册Filter</span></span><br><span class="line">        javax.servlet.FilterRegistration.Dynamic myFilter = servletContext.addFilter(<span class="string">"myFilter"</span>, MyFilter<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">//        myFilter.addMappingForServletNames(null, false, "myServlet");</span></span><br><span class="line">        myFilter.addMappingForUrlPatterns(<span class="keyword">null</span>, <span class="keyword">false</span>, <span class="string">"/custom/*"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果只是注册<code>Filter</code>，并且该<code>Filter</code>只会映射到<code>DispatcherServlet</code>上的话。可以重载<code>AbstractAnnotationConfigDispatcherServletInitializer</code>的<code>getServletFilters()</code>方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyWebAppInitializer.java</span></span><br><span class="line"><span class="keyword">package</span> com.yww.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebAppInitializer</span> <span class="keyword">extends</span> <span class="title">AbstractAnnotationConfigDispatcherServletInitializer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Filter[] getServletFilters() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Filter[]&#123; <span class="keyword">new</span> MyFilter()&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/29/deep_learning/paper/paper-Deep-Neural-Networks-for-Object-Detection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dejiang">
      <meta itemprop="description" content="你根本不知道你什么都不知道">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫の故事">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/29/deep_learning/paper/paper-Deep-Neural-Networks-for-Object-Detection/" class="post-title-link" itemprop="url">[paper] Deep Neural Networks for Object Detection</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-29 00:00:00" itemprop="dateCreated datePublished" datetime="2019-11-29T00:00:00+08:00">2019-11-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-29 23:44:23" itemprop="dateModified" datetime="2019-12-29T23:44:23+08:00">2019-12-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/deep-learning/" itemprop="url" rel="index">
                    <span itemprop="name">deep learning</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><ul>
<li>以往做法，采用运动学分解目标，作为图模型表达。</li>
<li>以往做法，结合浅层鉴别模型，和手动设计表达。</li>
</ul>
<h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><p><img src="/2019/11/29/deep_learning/paper/paper-Deep-Neural-Networks-for-Object-Detection/3.png" alt="show effect"></p>
<h1 id="贡献"><a href="#贡献" class="headerlink" title="贡献"></a>贡献</h1><ul>
<li>1.解决了对象的精确定位，和对象分类问题。</li>
<li>2.能够预测多个物体的边界框。</li>
<li>3.使用深度神经网络训练。</li>
</ul>
<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><p><img src="/2019/11/29/deep_learning/paper/paper-Deep-Neural-Networks-for-Object-Detection/1.png" alt="net"></p>
<p>算法步骤：<br><img src="/2019/11/29/deep_learning/paper/paper-Deep-Neural-Networks-for-Object-Detection/2.png" alt="algorithm"></p>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>损失函数：</p>
<script type="math/tex; mode=display">
\min _{\Theta} \sum_{(x, m) \in D}\left\|(\operatorname{Diag}(m)+\lambda I)^{1 / 2}(D N N(x ; \Theta)-m)\right\|_{2}^{2}</script><p>损失函数 = 平衡正负数据量 + DNN做深度神经网络计算预测目标相对于标签的误差</p>
<blockquote>
<ul>
<li>$\Theta$：网格参数。</li>
<li>预测目标的二进制蒙版：$DNN(x ; \Theta) \in \mathbb{R}^{N}$</li>
<li>N：像素的数量，$N=d \times d$。</li>
<li>m：图片x的蒙版标签，$m \in[0,1]^{N}$。</li>
<li>D：图片中包含标签的部分。</li>
<li>$\lambda$：$\lambda$非零值一致性权值。因为相对于图像，对象较小，很容易使网络被简单的分配全零捕获网络。输错0的惩罚小于输错1的，鼓励非零预测。（宁可认错，不愿错过）</li>
</ul>
<p>网络接受225x225的图片，预测蒙版尺寸为$d \times d$（d=24）。</p>
</blockquote>
<h1 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h1><p>通过DNN生成的掩码进行精确的对象定位 （Precise Object Localization via DNN-generated Masks）</p>
<p>问题：小的对象对神经元的影响非常小，因此难以辨识。</p>
<h2 id="多个蒙版实现可靠的集中-（Multiple-Masks-for-Robust-Localization）"><a href="#多个蒙版实现可靠的集中-（Multiple-Masks-for-Robust-Localization）" class="headerlink" title="多个蒙版实现可靠的集中 （Multiple Masks for Robust Localization）"></a>多个蒙版实现可靠的集中 （Multiple Masks for Robust Localization）</h2><script type="math/tex; mode=display">
m^{h}(i, j ; b b)=\frac{\operatorname{area}(b b(h) \cap T(i, j))}{\operatorname{area}(T(i, j))}</script><blockquote>
<ul>
<li>$m^h$：蒙版的5种切分。</li>
<li>bb：(bounding box)边界盒。</li>
<li>h：$h \in { \text{full, bottom, top, left, right}}$。</li>
<li>T(i, j)：表示预测的(i, j)那部分的图像。</li>
<li>d1：图像的高。</li>
<li>d2：图像的宽。</li>
<li>d：预划分的蒙版尺寸。</li>
</ul>
</blockquote>
<p>为处理多个接触目标，使用多个mask。</p>
<p>计算预测的掩码T和滑动窗口bb之间的比例。（前景像素的比例）</p>
<blockquote>
<p>每个mask需训练单独DNN，它们的定位器可以共享参数。</p>
</blockquote>
<h2 id="DNN输出中的对象集中-（Object-Localization-from-DNN-Output）"><a href="#DNN输出中的对象集中-（Object-Localization-from-DNN-Output）" class="headerlink" title="DNN输出中的对象集中 （Object Localization from DNN Output）"></a>DNN输出中的对象集中 （Object Localization from DNN Output）</h2><p>计算标签m和滑动窗口bb的重合量作为打分。</p>
<p>计算5种scale的mask，和这5种mask附加周边的分数差。（为了彻底搜索可能的bb）</p>
<p>计算的值大于0.5，再使用Alexnet对其分类：</p>
<blockquote>
<ul>
<li>S：bb和m重合的分数。</li>
</ul>
</blockquote>
<script type="math/tex; mode=display">
S(bb, m)=\frac{1}{area(bb)} \sum_{(i, j)} area(bb \cap T(i, j))</script><p>彻底地搜索可能的bb：</p>
<script type="math/tex; mode=display">
S(bb)=\sum_{h \in halves} (S(bb(h), m^h) - S(bb(\overline{h}, m^h)</script><blockquote>
<ul>
<li>$\overline{h}$：围绕bb的矩形区域。</li>
</ul>
</blockquote>
<p>滑动窗口步骤：使用9种(0.1,…,0.9)图像比例的对象框。用k-means聚类数据集的对象框，获取10种横纵比。以步长为5个像素滑动窗口。将此公式计算值大于0.5的，使用Alexnet分类。保存分类，剪枝。</p>
<h2 id="DNN定位器的多尺度优化-（Multi-scale-Refinement-of-DNN-Localizer）"><a href="#DNN定位器的多尺度优化-（Multi-scale-Refinement-of-DNN-Localizer）" class="headerlink" title="DNN定位器的多尺度优化 （Multi-scale Refinement of DNN Localizer）"></a>DNN定位器的多尺度优化 （Multi-scale Refinement of DNN Localizer）</h2><p>问题：前2个方法已经解决定位识别（大致定位），现需要优化得到不大不小的框。</p>
<h3 id="步骤1-滑动窗口"><a href="#步骤1-滑动窗口" class="headerlink" title="步骤1-滑动窗口"></a>步骤1-滑动窗口</h3><p>3个图像的scale，可以看作3个尺度为1x,2x,4x大小的窗口去扫描图片。步长控制在让每个窗口的overlap少于20%。最后对每个scale得到5个{full, bottom, top, left, right}detection结果，共15个detection结果。</p>
<h3 id="步骤2-refine"><a href="#步骤2-refine" class="headerlink" title="步骤2-refine"></a>步骤2-refine</h3><p>对上述15个detection的结果，将bb扩大1.2倍后，重新应用到网络。（如图2）</p>
<blockquote>
<p>论文认为，这个方法与滑动窗口不同，因为需要鉴定的滑动窗口少。</p>
</blockquote>
<h1 id="train"><a href="#train" class="headerlink" title="train"></a>train</h1><p>对于每个类别，都训练2个DNN，一个用于mask的定位模型，一个用于分类模型。</p>
<p>先训练分类模型，在用分类模型做pretrain训练定位模型。</p>
<p>计算交集公式Jaccard-similarity：$J(A, B) = \frac{A \cap B}{A \cup B}$</p>
<p>将J &lt; 0.2，视为负样本，J &gt; 0.6，视为正样本。</p>
<h1 id="more"><a href="#more" class="headerlink" title="more"></a>more</h1><h2 id="note"><a href="#note" class="headerlink" title="note"></a>note</h2><p>本文将深度神经网络应用到目标检测中。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/22/deep_learning/paper/paper-Cycle-Consistency-for-Robust-Visual-Question-Answering/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dejiang">
      <meta itemprop="description" content="你根本不知道你什么都不知道">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫の故事">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/22/deep_learning/paper/paper-Cycle-Consistency-for-Robust-Visual-Question-Answering/" class="post-title-link" itemprop="url">[paper] Cycle-Consistency for Robust Visual Question Answering</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-22 00:00:00" itemprop="dateCreated datePublished" datetime="2019-11-22T00:00:00+08:00">2019-11-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-27 14:42:29" itemprop="dateModified" datetime="2019-12-27T14:42:29+08:00">2019-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/deep-learning/" itemprop="url" rel="index">
                    <span itemprop="name">deep learning</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><ul>
<li>尽管可视化问答发展显著，但VQA的鲁棒性不足。</li>
<li>通过引入新的数据集和评估方式，证明当前最好的VQA模型对语言的变化的效果是脆弱的。</li>
<li>VQA发展：LSTM+CNN，attention networks，module networks，relational networks，multimodal fusion。</li>
<li>发现VQA领域缺乏量化测量鲁棒性的基准。</li>
</ul>
<h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><p>『之前的VQA模型，鲁棒性展示：同一语义，回答结果不同』<br><img src="/2019/11/22/deep_learning/paper/paper-Cycle-Consistency-for-Robust-Visual-Question-Answering/2.png" alt="show robust"></p>
<p>『采用CycleGAN后，鲁棒性展示』<br><img src="/2019/11/22/deep_learning/paper/paper-Cycle-Consistency-for-Robust-Visual-Question-Answering/3.png" alt="show robust"></p>
<h1 id="贡献"><a href="#贡献" class="headerlink" title="贡献"></a>贡献</h1><ul>
<li><strong>提出循环一致性（cycle-consistent）训练方式，使VQA模型应对语言变化更具鲁棒性</strong>。</li>
<li>提出评估VQA模型鲁棒性的方法。</li>
<li>提供新的数据集。（VQA-Rephrasings）</li>
<li>验证使用这种训练方法下，最先进的模型表现。</li>
</ul>
<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><p><img src="/2019/11/22/deep_learning/paper/paper-Cycle-Consistency-for-Robust-Visual-Question-Answering/1.png" alt="net"></p>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>网络原理基本同Cycle GAN。</p>
<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><ul>
<li>数据集问题$Q$，通过F:VQA模型生成回答$A^{\prime}$。</li>
<li>使用生成的回答$A^{\prime}$，通过G:VQG模型生成问题$Q^{\prime}$。</li>
<li>使用生成的问题$Q^{\prime}$，通过F:VQA模型生成回答$A^{\prime \prime}$。（与前面的F是同一个VQA模型）</li>
</ul>
<h2 id="损失函数"><a href="#损失函数" class="headerlink" title="损失函数"></a>损失函数</h2><ul>
<li>对比 原问题$Q$ 和 生成的问题$Q^{\prime}$，计算损失（Question Consistency Loss）。</li>
<li>对比 从原始问题得到回答的$A^{\prime}$ 和 数据标签$A$，计算损失（VQA Loss）。</li>
<li>对比 数据标签$A$ 和 从生成的问题$Q^{\prime}$得到的回答$A^{\prime \prime}$，计算损失（Answer Consistency Loss）。</li>
</ul>
<script type="math/tex; mode=display">
\begin{aligned}
\mathcal{L}_{\text {total}}=\mathcal{L}_{F}\left(A, A^{\prime}\right)+\lambda_{G} \mathcal{L}_{G}\left(Q, Q^{\prime}\right) \\
+\lambda_{C} \mathcal{L}_{\text {cycle}}\left(A, A^{\prime \prime}\right)
\end{aligned}</script><blockquote>
<p>$\lambda$各个损失项的系数。</p>
</blockquote>
<h1 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h1><h2 id="门机制-Gating-Mechanism"><a href="#门机制-Gating-Mechanism" class="headerlink" title="门机制 (Gating Mechanism)"></a>门机制 (Gating Mechanism)</h2><p>并非所有生成的问题都与I-Q-A一致，为此，作者提出一种门控机制，过滤掉一些不合适的问题。对于生成的问题$Q^{\prime}$，只保留答案与原答案的余弦相似性阈值大于$T<em>{sim}$的问题。(文中设$T</em>{sim}=0.9$)</p>
<h2 id="后期激活-Late-Activation"><a href="#后期激活-Late-Activation" class="headerlink" title="后期激活 (Late Activation)"></a>后期激活 (Late Activation)</h2><p>cycle-consistent关键的环节是防止模式坍塌（mode collapse）现象。为了确保各个子网络之间正常工作，作者通过在训练的最后阶段激活循环一致来解决。</p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="VQA改写数据集"><a href="#VQA改写数据集" class="headerlink" title="VQA改写数据集"></a>VQA改写数据集</h3><p>VQA模型要在同一个问题的不同改述之间保持一致，对所有改述的答案应该相同。使用CS(K)一致性评分来衡量。（其实就是简单计算改写问题有几个生成的答案一致的比例）</p>
<script type="math/tex; mode=display">
C S(k)=\sum_{Q^{\prime} \subset Q,\left|Q^{\prime}\right|=k} \frac{\mathcal{S}\left(Q^{\prime}\right)}{^{n} C_{k}}</script><script type="math/tex; mode=display">
\mathcal{S}\left(Q^{\prime}\right)=\left\{\begin{array}{ll}
{1} & {\text { if } \forall q \in Q^{\prime} \theta(q)>0} \\
{0} & {\text { otherwise }}
\end{array}\right.</script><blockquote>
<ul>
<li>问题集合Q有n个改写，选取其中k个。C是n里去k个的组合数量。</li>
<li>$\theta$是VQA的准确性。</li>
</ul>
</blockquote>
<h1 id="more"><a href="#more" class="headerlink" title="more"></a>more</h1><h2 id="note"><a href="#note" class="headerlink" title="note"></a>note</h2><p>这是一篇2019CVPR facebook的论文，将用于图像风格迁移的Cycle GAN应用到了VQA领域，实则是将其作为一种在线数据增强的手段，来达到其鲁棒性。</p>
<h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><ul>
<li>理解：<a href="https://blog.csdn.net/xiasli123/article/details/102887043" target="_blank" rel="noopener">https://blog.csdn.net/xiasli123/article/details/102887043</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/21/problem/problem-flask-api-vue-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="dejiang">
      <meta itemprop="description" content="你根本不知道你什么都不知道">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫の故事">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/21/problem/problem-flask-api-vue-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">[problem] flask api + vue 跨域问题</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-21 16:29:00" itemprop="dateCreated datePublished" datetime="2019-11-21T16:29:00+08:00">2019-11-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-26 15:45:09" itemprop="dateModified" datetime="2019-12-26T15:45:09+08:00">2019-12-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/problem/" itemprop="url" rel="index">
                    <span itemprop="name">problem</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>使用flask提供json数据，用vue在前端获取json数据展示。</p>
<p>发现无法获取到该json数据，但其它网站的api的json数据是可以拿到的。</p>
<h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><p>后来，查到是由于遇到<code>跨域请求</code>的问题，通过设置flask允许其它域访问即可。</p>
<p>域 = 协议名 + 主机名 + 端口号</p>
<p>禁止不同域的访问是为了防止<code>CSRF</code>(跨站请求伪造)攻击。</p>
<p>通过<code>CORS</code>(跨源资源共享)允许的请求。</p>
<p>添加如下语句开启允许访问的资源：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CORS(app, resources=<span class="string">r'/*'</span>)</span><br></pre></td></tr></table></figure></p>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><p><code>demo.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">CORS(app, resources=<span class="string">r'/*'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'hello'</span>: <span class="string">'world!'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure>
<p><code>test.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        ----</span><br><span class="line">        &#123;&#123;info&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/vue"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">        el:<span class="string">'#app'</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="actionscript">            info:<span class="string">''</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        created() &#123;</span><br><span class="line"><span class="actionscript">            fetch(<span class="string">'http://127.0.0.1:5000'</span>)</span></span><br><span class="line"><span class="javascript">            .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span></span><br><span class="line"><span class="javascript">            .then(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">this</span>.info = json</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h1><p>同理，不仅是flask会出现<code>跨域请求</code>的问题，其它语言为了安全性，也是有禁止跨域请求的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dejiang"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">dejiang</p>
  <div class="site-description" itemprop="description">你根本不知道你什么都不知道</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wwstory" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wwstory" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1018472917@qq.com" title="E-Mail → mailto:1018472917@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/maplesnow" title="cnblogs → https:&#x2F;&#x2F;www.cnblogs.com&#x2F;maplesnow" rel="noopener" target="_blank"><i class="fa fa-fw fa-cnblogs"></i>cnblogs</a>
      </span>
  </div>

<!-- old nav -->
<!--
<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
-->



      </div>

      <!-- nav -->
      <nav class="site-nav">
        
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

      </nav>

      <!-- music player -->
      <div>
        
          <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="//music.163.com/outchain/player?type=0&id=431226116&auto=0&height=32"></iframe>
        
      </div>

    </div>
  </aside>

  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dejiang</span>
</div>

        








        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
















  

  
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  

</body>
</html>
